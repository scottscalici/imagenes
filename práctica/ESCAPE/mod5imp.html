<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>M√≥dulo ‚Äì Nivel 5</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-100 text-slate-800 min-h-screen">
  <main class="max-w-6xl mx-auto px-4 py-8 space-y-8">

    <!-- STICKY HEADER WITH PROGRESS -->
    <header class="sticky top-0 z-20 bg-white shadow-sm">
      <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between gap-4">
        <div>
          <h1 class="text-lg sm:text-xl font-bold text-slate-800">
            Examen del semestre
          </h1>
          <p class="text-xs sm:text-sm text-slate-500">
            Nivel 5
          </p>
        </div>
        <div class="w-40 sm:w-64">
          <div class="w-full bg-slate-200 rounded-full h-2 overflow-hidden">
            <div id="progress-fill" class="h-2 bg-emerald-500 transition-all duration-300" style="width: 0%;"></div>
          </div>
          <p id="progress-label" class="text-[10px] sm:text-xs text-slate-600 mt-1 text-right">
            0 % completado
          </p>
        </div>
      </div>
    </header>

    <main class="max-w-6xl mx-auto px-4 py-6">
      <div class="grid md:grid-cols-[230px,1fr] gap-6">
        <!-- SIDEBAR -->
        <aside class="bg-white rounded-2xl shadow p-4 text-sm space-y-3">
          <h2 class="text-xs font-semibold text-slate-500 uppercase tracking-wide">
            M√≥dulos
          </h2>

          <!-- 1.1‚Äì1.4 Verbos -->
          <button class="module-tab w-full text-left px-3 py-2 rounded-lg flex items-center justify-between gap-2 bg-sky-50 text-sky-800 border border-sky-200 text-sm"
                  data-module="1">
            <span>M√≥dulo 1.1 ¬∑ Verbos</span>
            <span id="badge-1" class="text-xs">‚óè</span>
          </button>

          <button class="module-tab w-full text-left px-3 py-2 rounded-lg flex items-center justify-between gap-2 bg-slate-50 text-slate-500 border border-slate-200 text-sm"
                  data-module="2" disabled>
            <span>M√≥dulo 1.2 ¬∑ Verbos</span>
            <span id="badge-2" class="text-xs">üîí</span>
          </button>

          <button class="module-tab w-full text-left px-3 py-2 rounded-lg flex items-center justify-between gap-2 bg-slate-50 text-slate-500 border border-slate-200 text-sm"
                  data-module="3" disabled>
            <span>M√≥dulo 1.3 ¬∑ Verbos</span>
            <span id="badge-3" class="text-xs">üîí</span>
          </button>

          <button class="module-tab w-full text-left px-3 py-2 rounded-lg flex items-center justify-between gap-2 bg-slate-50 text-slate-500 border border-slate-200 text-sm"
                  data-module="4" disabled>
            <span>M√≥dulo 1.4 ¬∑ Verbos</span>
            <span id="badge-4" class="text-xs">üîí</span>
          </button>

          <!-- 2.1 Lectura -->
          <button class="module-tab w-full text-left px-3 py-2 rounded-lg flex items-center justify-between gap-2 bg-slate-50 text-slate-500 border border-slate-200 text-sm"
                  data-module="5" disabled>
            <span>M√≥dulo 2.1 ¬∑ Lectura</span>
            <span id="badge-5" class="text-xs">üîí</span>
          </button>

          <!-- 3.1 Preguntas de comprensi√≥n -->
          <button class="module-tab w-full text-left px-3 py-2 rounded-lg flex items-center justify-between gap-2 bg-slate-50 text-slate-500 border border-slate-200 text-sm"
                  data-module="6" disabled>
            <span>M√≥dulo 3.1 ¬∑ Preguntas</span>
            <span id="badge-6" class="text-xs">üîí</span>
          </button>
        </aside>

        <!-- MAIN PANEL -->
        <section class="bg-white rounded-2xl shadow p-5 md:p-6 min-h-[320px]">

          <!-- Module 1.1 -->
          <div id="module-1" class="module-view space-y-4">
            <h2 class="text-xl font-semibold text-slate-800">
              M√≥dulo 1.1 ¬∑ Verbos (imperfecto)
            </h2>
            <p class="text-sm text-slate-600">
              Completa las formas verbales. Necesitas <strong>100&nbsp;%</strong> para avanzar al siguiente m√≥dulo.
            </p>

            <div id="module-1-questions" class="space-y-3"></div>

            <div class="flex flex-wrap items-center gap-3 pt-2">
              <button id="btn-check-module-1"
                      class="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-sky-600 hover:bg-sky-700 text-white text-sm font-semibold">
                Corregir respuestas
              </button>
              <p id="module-1-result" class="text-sm text-slate-700"></p>
            </div>

            <div class="flex justify-end pt-4 border-t border-slate-100 mt-4">
              <button id="btn-next-from-1"
                      class="px-4 py-2 rounded-lg bg-slate-300 text-slate-600 text-sm font-semibold cursor-not-allowed"
                      disabled>
                Siguiente m√≥dulo (1.2) ‚Üí
              </button>
            </div>
          </div>

          <!-- Module 1.2 -->
          <div id="module-2" class="module-view space-y-4 hidden">
            <h2 class="text-xl font-semibold text-slate-800">
              M√≥dulo 1.2 ¬∑ Verbos (presente)
            </h2>
            <p class="text-sm text-slate-600">
              Segundo bloque de este conjunto de pr√°ctica.
            </p>

            <div id="module-2-questions" class="space-y-3"></div>

            <div class="flex flex-wrap items-center gap-3 pt-2">
              <button id="btn-check-module-2"
                      class="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-sky-600 hover:bg-sky-700 text-white text-sm font-semibold">
                Corregir respuestas
              </button>
              <p id="module-2-result" class="text-sm text-slate-700"></p>
            </div>

            <div class="flex justify-between pt-4 border-t border-slate-100 mt-4">
              <button class="px-3 py-2 rounded-lg bg-slate-100 text-slate-700 text-sm font-semibold"
                      data-go-module="1">
                ‚Üê Volver a 1.1
              </button>
              <button id="btn-next-from-2"
                      class="px-4 py-2 rounded-lg bg-slate-300 text-slate-600 text-sm font-semibold cursor-not-allowed"
                      disabled>
                Siguiente m√≥dulo (1.3) ‚Üí
              </button>
            </div>
          </div>

          <!-- Module 1.3 -->
          <div id="module-3" class="module-view space-y-4 hidden">
            <h2 class="text-xl font-semibold text-slate-800">
              M√≥dulo 1.3 ¬∑ Verbos (presente)
            </h2>
            <p class="text-sm text-slate-600">
              Tercer bloque de este conjunto de pr√°ctica.
            </p>

            <div id="module-3-questions" class="space-y-3"></div>

            <div class="flex flex-wrap items-center gap-3 pt-2">
              <button id="btn-check-module-3"
                      class="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-sky-600 hover:bg-sky-700 text-white text-sm font-semibold">
                Corregir respuestas
              </button>
              <p id="module-3-result" class="text-sm text-slate-700"></p>
            </div>

            <div class="flex justify-between pt-4 border-t border-slate-100 mt-4">
              <button class="px-3 py-2 rounded-lg bg-slate-100 text-slate-700 text-sm font-semibold"
                      data-go-module="2">
                ‚Üê Volver a 1.2
              </button>
              <button id="btn-next-from-3"
                      class="px-4 py-2 rounded-lg bg-slate-300 text-slate-600 text-sm font-semibold cursor-not-allowed"
                      disabled>
                Siguiente m√≥dulo (1.4) ‚Üí
              </button>
            </div>
          </div>

          <!-- Module 1.4 -->
          <div id="module-4" class="module-view space-y-4 hidden">
            <h2 class="text-xl font-semibold text-slate-800">
              M√≥dulo 1.4 ¬∑ Verbos (pret√©rito)
            </h2>
            <p class="text-sm text-slate-600">
              √öltimo bloque de verbos de este conjunto.
            </p>

            <div id="module-4-questions" class="space-y-3"></div>

            <div class="flex flex-wrap items-center gap-3 pt-2">
              <button id="btn-check-module-4"
                      class="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-sky-600 hover:bg-sky-700 text-white text-sm font-semibold">
                Corregir respuestas
              </button>
              <p id="module-4-result" class="text-sm text-slate-700"></p>
            </div>

            <div class="flex justify-between pt-4 border-t border-slate-100 mt-4">
              <button class="px-3 py-2 rounded-lg bg-slate-100 text-slate-700 text-sm font-semibold"
                      data-go-module="3">
                ‚Üê Volver a 1.3
              </button>
              <button id="btn-next-from-4"
                      class="px-4 py-2 rounded-lg bg-slate-300 text-slate-600 text-sm font-semibold cursor-not-allowed"
                      disabled>
                Ir al M√≥dulo 2.1 (lectura) ‚Üí
              </button>
            </div>
          </div>

         <!-- Module 2.1 ‚Äì Lectura --> 
<div id="module-5" class="module-view space-y-4 hidden">
  <h2 class="text-xl font-semibold text-slate-800">
    M√≥dulo 2.1 ¬∑ Lectura
  </h2>
  <p class="text-sm text-slate-600">
    Lee el siguiente texto con atenci√≥n. Cuando termines, haz clic en el bot√≥n de abajo.
  </p>

  <article class="prose max-w-none text-sm text-slate-800 bg-slate-50 rounded-lg p-4 border border-slate-200">
    <p>
      Terra.com es el sitio web favorito entre los hispanos que viven en los Estados Unidos. 
      El 66% (per cent) de los hispanos que conocen este sitio lo visitan por lo menos una vez al mes.
    </p>

    <p>
      Otros sitios web muy populares entre los hispanos que navegan en Internet son latino.msn.com, 
      espanol.yahoo.com y el sitio de viajes despegar.com.
    </p>

    <p>
      La preferencia por estos sitios web tiene un motivo (cause, reason) claro: aunque (although) 
      vivan en los Estados Unidos, los hispanos prefieren el espa√±ol a la hora de navegar en Internet. 
      El n√∫mero de personas que prefieren esta lengua al ingl√©s se ha disparado (has shot up) en los 
      √∫ltimos a√±os, pasando del 33% en el 2000 al 68% actual.
    </p>

    <p>
      La edad promedio (average) de los usuarios (users) hispanos es de treinta a√±os y m√°s de la mitad 
      (half) son biling√ºes. Adem√°s, la brecha (gap) digital que separa a hombres y mujeres es muy poca; 
      existe una peque√±a mayor√≠a de hombres (52%) frente a un 48% de mujeres.
    </p>

    <p>
      Se trata, definitivamente, de personas que disfrutan de (enjoy) acceso a Internet con cierta facilidad 
      (with some ease) (el 78% tiene una computadora en casa).
    </p>

    <p>
      El poder (power) de seducci√≥n que Internet tiene sobre la poblaci√≥n hispana de los Estados Unidos 
      se refleja en sus usos y costumbres. El usuario hispano visita la red 6,6 veces por semana y cada vez 
      que lo hace permanece (remains) conectado un promedio de 58 minutos. Entra a Internet para consultar 
      informaci√≥n, escuchar m√∫sica, buscar informaci√≥n espec√≠fica para su formaci√≥n profesional, enviar y 
      recibir correo electr√≥nico y comunicarse a trav√©s de los chats.
    </p>
  </article>

  <div class="flex justify-between pt-4 border-t border-slate-100 mt-4">
    <button class="px-3 py-2 rounded-lg bg-slate-100 text-slate-700 text-sm font-semibold"
            data-go-module="4">
      ‚Üê Volver a 1.4
    </button>
    <button id="btn-finish-reading"
            class="px-4 py-2 rounded-lg bg-emerald-600 hover:bg-emerald-700 text-white text-sm font-semibold">
      He terminado de leer
    </button>
  </div>
</div>


          <!-- Module 3.1 ‚Äì Preguntas de comprensi√≥n -->
  <div id="module-6" class="module-view space-y-4 hidden">
    <h2 class="text-xl font-semibold text-slate-800">
      M√≥dulo 3.1 ¬∑ Comprensi√≥n de lectura
    </h2>
<!-- ‚úÖ PREGUNTAS DE COMPRENSI√ìN -->
<section class="space-y-4">
  <h3 class="text-lg font-semibold text-slate-800">Preguntas de comprensi√≥n</h3>
  <p class="text-sm text-slate-600">
    Contesta. Al conseguir 100%, se desbloquea la entrada del c√≥digo.
  </p>

  <div id="reading-questions" class="space-y-3">
    <!-- EJEMPLO (duplica y edita): data-answer es lo que aceptas -->
    <div class="space-y-1 quiz-item" data-answer="terra.com">
      <label class="text-sm font-medium text-slate-800">
        1) ¬øCu√°l es el sitio web favorito entre los hispanos en EE.UU.?
      </label>
      <input type="text"
             class="w-full border rounded-lg px-3 py-1.5 text-sm focus:outline-none focus:ring-2 focus:ring-sky-400" />
      <p class="text-xs feedback hidden"></p>
    </div>

    <!-- Agrega m√°s preguntas aqu√≠... -->
  </div>

  <div class="flex flex-wrap items-center gap-3 pt-2">
    <button id="btn-check-reading"
            class="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-semibold">
      Corregir respuestas
    </button>
    <p id="reading-result" class="text-sm text-slate-700"></p>
  </div>

  <!-- üîê CODE GATE (hidden until 100%) -->
  <div id="code-gate" class="hidden mt-3 p-4 rounded-xl border border-emerald-200 bg-emerald-50">
    <p class="text-sm text-emerald-900 font-semibold">‚úÖ Desbloqueado: escribe el c√≥digo</p>
    <div class="mt-2 flex flex-col sm:flex-row gap-2">
      <input id="codeInput"
             type="text"
             placeholder="C√≥digo‚Ä¶"
             class="flex-1 border rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-emerald-400" />
      <button id="btn-submit-code"
              class="px-4 py-2 rounded-lg bg-emerald-600 hover:bg-emerald-700 text-white text-sm font-semibold">
        Entrar
      </button>
    </div>
    <p id="codeFeedback" class="text-sm mt-2"></p>
  </div>
</section>

    <!-- ‚úÖ M√ìDULO: Orden de colores (arrastrar y soltar) -->
<section id="module-colores" class="space-y-6">

  <div class="bg-white border border-slate-200 rounded-2xl shadow p-6">
    <h2 class="text-xl font-semibold text-slate-800">M√≥dulo ¬∑ Orden secreto</h2>
    <p class="text-sm text-slate-600 mt-1">
      Arrastra los colores al orden correcto. (Pista: el ‚Äúprimer paso‚Äù de cada respuesta‚Ä¶)
    </p>
  </div>

  <!-- PALETA -->
  <div class="bg-white border border-slate-200 rounded-2xl shadow p-6">
    <h3 class="text-sm font-semibold text-slate-700 mb-3">Paleta</h3>

    <div id="palette"
         class="flex flex-wrap gap-3 items-center"
         aria-label="Paleta de colores">

      <!-- Cada swatch tiene data-color con el nombre -->
      <img class="swatch w-14 h-14 rounded-xl border border-slate-200 shadow-sm cursor-grab active:cursor-grabbing"
           draggable="true"
           data-color="amarillo"
           alt="amarillo"
           src="https://raw.githubusercontent.com/scottscalici/imagenes/refs/heads/main/pr%C3%A1ctica/ESCAPE/amarillo.png" />

      <img class="swatch w-14 h-14 rounded-xl border border-slate-200 shadow-sm cursor-grab active:cursor-grabbing"
           draggable="true"
           data-color="anaranjado"
           alt="anaranjado"
           src="https://raw.githubusercontent.com/scottscalici/imagenes/refs/heads/main/pr%C3%A1ctica/ESCAPE/anaranjado.png" />

      <img class="swatch w-14 h-14 rounded-xl border border-slate-200 shadow-sm cursor-grab active:cursor-grabbing"
           draggable="true"
           data-color="azul"
           alt="azul"
           src="https://raw.githubusercontent.com/scottscalici/imagenes/refs/heads/main/pr%C3%A1ctica/ESCAPE/azul.png" />

      <img class="swatch w-14 h-14 rounded-xl border border-slate-200 shadow-sm cursor-grab active:cursor-grabbing"
           draggable="true"
           data-color="rojo"
           alt="rojo"
           src="https://raw.githubusercontent.com/scottscalici/imagenes/refs/heads/main/pr%C3%A1ctica/ESCAPE/rojo.png" />

      <img class="swatch w-14 h-14 rounded-xl border border-slate-200 shadow-sm cursor-grab active:cursor-grabbing"
           draggable="true"
           data-color="verde"
           alt="verde"
           src="https://raw.githubusercontent.com/scottscalici/imagenes/refs/heads/main/pr%C3%A1ctica/ESCAPE/verde.png" />

      <img class="swatch w-14 h-14 rounded-xl border border-slate-200 shadow-sm cursor-grab active:cursor-grabbing"
           draggable="true"
           data-color="morado"
           alt="morado"
           src="https://raw.githubusercontent.com/scottscalici/imagenes/refs/heads/main/pr%C3%A1ctica/ESCAPE/morado.png" />
    </div>

    <p class="text-xs text-slate-500 mt-3">
      Puedes usar un color m√°s de una vez.
    </p>
  </div>

  <!-- SLOTS -->
  <div class="bg-white border border-slate-200 rounded-2xl shadow p-6">
    <div class="flex items-center justify-between gap-4 flex-wrap">
      <h3 class="text-sm font-semibold text-slate-700">Orden (1‚Äì10)</h3>

      <div class="flex gap-2">
        <button id="checkBtn"
                class="px-4 py-2 rounded-xl bg-indigo-600 text-white text-sm font-semibold hover:bg-indigo-700">
          Comprobar
        </button>
        <button id="resetBtn"
                class="px-4 py-2 rounded-xl bg-slate-200 text-slate-800 text-sm font-semibold hover:bg-slate-300">
          Reiniciar
        </button>
      </div>
    </div>

    <div id="slots"
         class="mt-4 grid grid-cols-2 sm:grid-cols-5 gap-4">
      <!-- 10 drop zones -->
      <!-- Each slot holds exactly 1 swatch -->
      <div class="slot" data-slot="1"></div>
      <div class="slot" data-slot="2"></div>
      <div class="slot" data-slot="3"></div>
      <div class="slot" data-slot="4"></div>
      <div class="slot" data-slot="5"></div>
      <div class="slot" data-slot="6"></div>
      <div class="slot" data-slot="7"></div>
      <div class="slot" data-slot="8"></div>
      <div class="slot" data-slot="9"></div>
      <div class="slot" data-slot="10"></div>
    </div>

    <p id="feedback" class="text-sm mt-4 font-medium"></p>
</div> <!-- end module-6 -->

    <!-- PASSWORD REVEAL -->
    <div id="passwordBox" class="hidden mt-4 p-4 rounded-xl border border-emerald-200 bg-emerald-50">
      <p class="text-sm text-emerald-900">
        ‚úÖ ¬°Correcto! Tu contrase√±a es:
        <span id="passwordText" class="font-bold"></span>
      </p>
    <div class="mt-3">
  <a href="m6escapar.html"
     class="inline-flex items-center justify-center px-4 py-2 rounded-lg
            bg-emerald-600 hover:bg-emerald-700
            text-white text-sm font-semibold
            shadow-sm transition">
    Continuar ‚Üí
  </a>
</div>


    </div>
  </div>

</section>


    </main>
  </main>

  <script>
    // üëâ JSON de verbos para esta p√°gina
    const PRACTICE_JSON_URL =
      'https://raw.githubusercontent.com/scottscalici/imagenes/main/pr√°ctica/ESCAPE/verbos5.json';

    // 4 m√≥dulos de verbos + 1 de lectura + 1 de preguntas
    const TOTAL_MODULES = 6;
    const PASS_THRESHOLD = 1.0;

    const progressFill = document.getElementById('progress-fill');
    const progressLabel = document.getElementById('progress-label');
    const modulePassed = {};
    let completedModules = 0;

    function updateProgress() {
      const percent = Math.round((completedModules / TOTAL_MODULES) * 100);
      progressFill.style.width = percent + '%';
      progressLabel.textContent = percent + '% completado';
    }

    function markModuleCompleted(n) {
      if (!modulePassed[n]) {
        modulePassed[n] = true;
        completedModules = Object.keys(modulePassed).length;
        updateProgress();
        const badge = document.getElementById('badge-' + n);
        if (badge) badge.textContent = '‚úî';
      }
    }

    function unlockModuleBtn(n) {
      const tab = document.querySelector('.module-tab[data-module="' + n + '"]');
      const badge = document.getElementById('badge-' + n);
      if (tab) {
        tab.disabled = false;
        tab.classList.remove('text-slate-500');
      }
      if (badge && badge.textContent === 'üîí') {
        badge.textContent = '‚óè';
      }
    }

    function showModule(n) {
      document.querySelectorAll('.module-view').forEach(view =>
        view.classList.add('hidden')
      );
      const active = document.getElementById('module-' + n);
      if (active) active.classList.remove('hidden');

      document.querySelectorAll('.module-tab').forEach(btn => {
        const m = btn.dataset.module;
        if (String(m) === String(n)) {
          btn.classList.add('bg-sky-50', 'text-sky-800', 'border-sky-300');
          btn.classList.remove('bg-slate-50', 'text-slate-500', 'border-slate-200');
        } else {
          btn.classList.remove('bg-sky-50', 'text-sky-800', 'border-sky-300');
          btn.classList.add('bg-slate-50', 'text-slate-500', 'border-slate-200');
        }
      });
    }

    // ------- VERBOS 1‚Äì4 --------
    function buildVerbModule(moduleNumber, items) {
      const container = document.getElementById('module-' + moduleNumber + '-questions');
      if (!container) return;
      container.innerHTML = '';

      items.forEach((item, index) => {
        const wrapper = document.createElement('div');
        wrapper.className = 'space-y-1 quiz-item';
        wrapper.dataset.answer = item.forma;

        const sujeto = item.sujeto || '';
        const contexto = item.contexto || '___';
        const infinitivo = item.infinitivo || '';

        wrapper.innerHTML = `
          <label class="text-sm font-medium text-slate-800">
            ${index + 1}. ${sujeto} ${contexto} (${infinitivo})
          </label>
          <input type="text"
                 class="w-full border rounded-lg px-3 py-1.5 text-sm focus:outline-none focus:ring-2 focus:ring-sky-400" />
          <p class="text-xs text-slate-500 feedback hidden"></p>
        `;
        container.appendChild(wrapper);
      });
    }

    function buildAllVerbModules(items) {
      const chunkSize = 5;
      for (let moduleNum = 1; moduleNum <= 4; moduleNum++) {
        const start = (moduleNum - 1) * chunkSize;
        const slice = items.slice(start, start + chunkSize);
        if (!slice.length) break;
        buildVerbModule(moduleNum, slice);
      }
    }

    function attachQuizHandler(moduleNumber) {
      // ------- Preguntas de comprensi√≥n (module 6) -------
const btnCheckReading = document.getElementById('btn-check-reading');
const readingResult   = document.getElementById('reading-result');

const codeGate     = document.getElementById('code-gate');
const codeInput    = document.getElementById('codeInput');
const btnSubmitCode= document.getElementById('btn-submit-code');
const codeFeedback = document.getElementById('codeFeedback');

// ‚úÖ the code they must enter after earning 100%
const FINAL_CODE = "t6le37";

function normalize(str) {
  return (str || "")
    .trim()
    .toLowerCase()
    .replace(/\s+/g, ""); // ignore spaces
}

if (btnCheckReading) {
  btnCheckReading.addEventListener('click', () => {
    const items = document.querySelectorAll('#reading-questions .quiz-item');

    // require all fields
    let missing = false;
    items.forEach(item => {
      const input = item.querySelector('input');
      if (!input) return;
      const val = (input.value || '').trim();
      if (!val) {
        missing = true;
        input.classList.remove('border-emerald-400', 'border-red-400');
        input.classList.add('border-yellow-400');
      }
    });

    if (missing) {
      readingResult.textContent = 'Responde todos los campos antes de corregir.';
      readingResult.classList.remove('text-emerald-700');
      readingResult.classList.add('text-red-600');
      if (codeGate) codeGate.classList.add('hidden');
      return;
    }

    // grade without revealing answers
    let correct = 0;
    items.forEach(item => {
      const input = item.querySelector('input');
      const feedback = item.querySelector('.feedback');

      const expected = normalize(item.dataset.answer);
      const userVal  = normalize(input.value);

      if (userVal === expected) {
        correct++;
        input.classList.remove('border-red-400', 'border-yellow-400');
        input.classList.add('border-emerald-400');
        if (feedback) {
          feedback.textContent = '‚úî Correcto';
          feedback.classList.remove('hidden', 'text-red-500');
          feedback.classList.add('text-emerald-600');
        }
      } else {
        input.classList.remove('border-emerald-400', 'border-yellow-400');
        input.classList.add('border-red-400');
        if (feedback) {
          feedback.textContent = '‚úò Incorrecto';
          feedback.classList.remove('hidden', 'text-emerald-600');
          feedback.classList.add('text-red-500');
        }
      }
    });

    const total = items.length;
    const score = total ? correct / total : 0;

    readingResult.textContent = `Obtuviste ${correct} de ${total} (${Math.round(score * 100)} %).`;

    if (score >= PASS_THRESHOLD) {
      readingResult.classList.remove('text-red-600');
      readingResult.classList.add('text-emerald-700');

      // ‚úÖ unlock module completion + show code gate
      markModuleCompleted(6);
      if (codeGate) codeGate.classList.remove('hidden');

      if (codeFeedback) codeFeedback.textContent = '';
      if (codeInput) codeInput.value = '';
    } else {
      readingResult.classList.remove('text-emerald-700');
      readingResult.classList.add('text-red-600');
      if (codeGate) codeGate.classList.add('hidden');
    }
  });
}

if (btnSubmitCode) {
  btnSubmitCode.addEventListener('click', () => {
    const attempt = normalize(codeInput?.value);
    if (attempt === FINAL_CODE) {
      // ‚úÖ go to next page
      window.location.href = "m6escapar.html";
    } else {
      if (codeFeedback) {
        codeFeedback.className = "text-sm mt-2 text-red-600";
        codeFeedback.textContent = "‚ùå C√≥digo incorrecto. Int√©ntalo otra vez.";
      }
    }
  });
}

// optional: Enter key submits code
if (codeInput) {
  codeInput.addEventListener("keydown", (e) => {
    if (e.key === "Enter") btnSubmitCode?.click();
  });
}

    async function loadPracticeSet() {
      try {
        const res = await fetch(PRACTICE_JSON_URL);
        const data = await res.json();
        const items = data;
        buildAllVerbModules(items);
        [1, 2, 3, 4].forEach(attachQuizHandler);
      } catch (err) {
        console.error('Error al cargar el JSON de pr√°ctica:', err);
        const result = document.getElementById('module-1-result');
        if (result) {
          result.textContent = 'No se pudo cargar el conjunto de pr√°ctica (revisa la URL del JSON).';
          result.classList.add('text-red-600');
        }
      }
    }

    // Next buttons 1‚Äì4 (internal navigation)
    for (let i = 1; i <= 4; i++) {
      const nextBtn = document.getElementById('btn-next-from-' + i);
      if (!nextBtn) continue;
      nextBtn.addEventListener('click', () => {
        const target = i + 1; // 1‚Üí2, 2‚Üí3, 3‚Üí4, 4‚Üí5
        const tab = document.querySelector('.module-tab[data-module="' + target + '"]');
        if (tab && !tab.disabled) showModule(target);
      });
    }

    // Sidebar tabs
    document.querySelectorAll('.module-tab').forEach(btn => {
      btn.addEventListener('click', () => {
        const num = Number(btn.dataset.module);
        if (btn.disabled) return;
        showModule(num);
      });
    });

    // "Volver a m√≥dulo X" buttons
    document.querySelectorAll('[data-go-module]').forEach(btn => {
      btn.addEventListener('click', () => {
        const num = Number(btn.dataset.goModule);
        showModule(num);
      });
    });

    // ------- Lectura (module 5) -> desbloquea preguntas (module 6) ------
    const finishReadingBtn = document.getElementById('btn-finish-reading');
    if (finishReadingBtn) {
      finishReadingBtn.addEventListener('click', () => {
        markModuleCompleted(5);
        unlockModuleBtn(6);
        showModule(6);
      });
    }

    // ------- Preguntas de comprensi√≥n (module 6) -------
    const btnCheckReading = document.getElementById('btn-check-reading');
    const readingResult = document.getElementById('reading-result');
    const btnShowPassword = document.getElementById('btn-show-password');
    const passwordDisplay = document.getElementById('password-display');

    if (btnCheckReading) {
      btnCheckReading.addEventListener('click', () => {
        const items = document.querySelectorAll('#reading-questions .quiz-item');

        let missing = false;
        items.forEach(item => {
          const input = item.querySelector('input');
          const feedback = item.querySelector('.feedback');
          if (!input) return;
          const val = (input.value || '').trim();
          if (!val) {
            missing = true;
            input.classList.remove('border-emerald-400', 'border-red-400');
            input.classList.add('border-yellow-400');
            if (feedback) feedback.classList.add('hidden');
          }
        });

        if (missing) {
          readingResult.textContent = 'Responde todos los campos antes de corregir.';
          readingResult.classList.remove('text-emerald-700');
          readingResult.classList.add('text-red-600');
          return;
        }

        let correct = 0;
        items.forEach(item => {
          const rawAnswer = (item.dataset.answer || '').trim().toLowerCase();
          const input = item.querySelector('input');
          const feedback = item.querySelector('.feedback');
          const userVal = (input.value || '').trim().toLowerCase();

          if (userVal === rawAnswer) {
            correct++;
            input.classList.remove('border-red-400', 'border-yellow-400');
            input.classList.add('border-emerald-400');
            if (feedback) {
              feedback.textContent = '';
              feedback.classList.add('hidden');
            }
          } else {
            input.classList.remove('border-emerald-400', 'border-yellow-400');
            input.classList.add('border-red-400');
            if (feedback) {
              feedback.textContent = `‚ùå Respuesta esperada: ${rawAnswer}`;
              feedback.classList.remove('hidden');
              feedback.classList.add('text-red-500');
            }
          }
        });

        const total = items.length;
        const score = total ? correct / total : 0;
        readingResult.textContent =
          `Obtuviste ${correct} de ${total} (${Math.round(score * 100)} %).`;

        if (score >= PASS_THRESHOLD) {
          readingResult.classList.remove('text-red-600');
          readingResult.classList.add('text-emerald-700');

          markModuleCompleted(6);

          if (btnShowPassword) {
            btnShowPassword.disabled = false;
            btnShowPassword.classList.remove(
              'bg-slate-300',
              'text-slate-600',
              'cursor-not-allowed'
            );
            btnShowPassword.classList.add(
              'bg-emerald-600',
              'hover:bg-emerald-700',
              'text-white'
            );
          }
        } else {
          readingResult.classList.remove('text-emerald-700');
          readingResult.classList.add('text-red-600');
        }
      });
    }

    if (btnShowPassword && passwordDisplay) {
      btnShowPassword.addEventListener('click', () => {
        passwordDisplay.classList.remove('hidden');
        // aqu√≠ puedes tambi√©n poner un link al siguiente nivel
      });
    }

    // Init
    updateProgress();
    showModule(1);
    loadPracticeSet();
  </script>
    
<style>
  .slot {
    height: 86px;
    border: 2px dashed #cbd5e1;
    border-radius: 16px;
    display: grid;
    place-items: center;
    position: relative;
    background: #f8fafc;
  }
  .slot[data-filled="true"] { border-style: solid; }
  .slot::before{
    content: attr(data-slot);
    position: absolute;
    top: 6px;
    left: 10px;
    font-size: 12px;
    color: #64748b;
    font-weight: 700;
  }
  .ghost { opacity: 0.45; transform: scale(0.98); }
</style>

<script>
document.addEventListener("DOMContentLoaded", () => {

  const ANSWER_ORDER = [
    "azul",
    "rojo",
    "verde",
    "amarillo",
    "morado",
    "anaranjado",
    "azul",
    "verde",
    "rojo",
    "amarillo"
  ];

  const PASSWORD = "PuraVida";

  const palette = document.getElementById("palette");
  const feedback = document.getElementById("feedback");
  const passwordBox = document.getElementById("passwordBox");
  const passwordText = document.getElementById("passwordText");
  const checkBtn = document.getElementById("checkBtn");
  const resetBtn = document.getElementById("resetBtn");

  // If module-6 is hidden at page load, this is still OK.
  // We just attach listeners once.

  // Make palette swatches draggable
  function wireSwatch(img) {
    img.addEventListener("dragstart", (e) => {
      img.classList.add("ghost");
      e.dataTransfer.setData("text/color", img.dataset.color);
      e.dataTransfer.setData("text/src", img.src);
      e.dataTransfer.effectAllowed = "copy";
    });
    img.addEventListener("dragend", () => img.classList.remove("ghost"));
  }
  document.querySelectorAll("#palette .swatch").forEach(wireSwatch);

  // Activate slots
  document.querySelectorAll(".slot").forEach(slot => {
    slot.classList.add("shadow-sm");

    slot.addEventListener("dragover", (e) => {
      e.preventDefault(); // REQUIRED: allows dropping
      slot.classList.add("ring-2", "ring-sky-400");
    });

    slot.addEventListener("dragleave", () => {
      slot.classList.remove("ring-2", "ring-sky-400");
    });

    slot.addEventListener("drop", (e) => {
      e.preventDefault();
      slot.classList.remove("ring-2", "ring-sky-400");

      const color = e.dataTransfer.getData("text/color");
      const src = e.dataTransfer.getData("text/src");
      if (!color || !src) return;

      // Only 1 per slot (click to remove)
      if (slot.querySelector("img")) return;

      const placed = document.createElement("img");
      placed.src = src;
      placed.alt = color;
      placed.dataset.color = color;
      placed.className = "w-14 h-14 rounded-xl border border-slate-200 shadow-sm cursor-pointer";
      placed.title = "Clic para quitar";

      placed.addEventListener("click", () => {
        placed.remove();
        slot.dataset.filled = "false";
        slot.classList.remove("border-emerald-300", "bg-emerald-50", "border-rose-300", "bg-rose-50");
        slot.style.borderColor = "";
      });

      slot.appendChild(placed);
      slot.dataset.filled = "true";

      if (feedback) feedback.textContent = "";
      if (passwordBox) passwordBox.classList.add("hidden");
    });
  });

// Check answers (ALL OR NOTHING)
if (checkBtn) {
  checkBtn.addEventListener("click", () => {
    const slots = Array.from(document.querySelectorAll(".slot"));
    const user = slots.map(s => s.querySelector("img")?.dataset.color || "");

    // Must fill all 10
    if (user.some(x => !x)) {
      if (feedback) {
        feedback.className = "text-sm mt-4 font-medium text-amber-700";
        feedback.textContent = "‚õî Falta completar uno o m√°s espacios (1‚Äì10).";
      }
      if (passwordBox) passwordBox.classList.add("hidden");
      return;
    }

    const isPerfect = user.every((val, i) => val === ANSWER_ORDER[i]);

    // ‚úÖ Do NOT color-code slots individually
    slots.forEach(slot => {
      slot.classList.remove("border-emerald-300", "bg-emerald-50", "border-rose-300", "bg-rose-50");
      slot.style.borderColor = "";
    });

    if (isPerfect) {
      if (feedback) {
        feedback.className = "text-sm mt-4 font-medium text-emerald-700";
        feedback.textContent = "‚úÖ ¬°Perfecto! Orden correcto.";
      }
      if (passwordText) passwordText.textContent = PASSWORD;
      if (passwordBox) passwordBox.classList.remove("hidden");
    } else {
      if (feedback) {
        feedback.className = "text-sm mt-4 font-medium text-rose-700";
        feedback.textContent = "‚ùå No est√° correcto todav√≠a. Revisa el orden e int√©ntalo de nuevo.";
      }
      if (passwordBox) passwordBox.classList.add("hidden");
    }
  });
}


  // Reset
  if (resetBtn) {
    resetBtn.addEventListener("click", () => {
      document.querySelectorAll(".slot img").forEach(img => img.remove());
      document.querySelectorAll(".slot").forEach(slot => {
        slot.dataset.filled = "false";
        slot.classList.remove("border-emerald-300", "bg-emerald-50", "border-rose-300", "bg-rose-50");
        slot.style.borderColor = "";
      });
      if (feedback) feedback.textContent = "";
      if (passwordBox) passwordBox.classList.add("hidden");
    });
  }

});
</script>
</body>
        </html>

<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Crucigrama – Vocabulario de la salud</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-100 text-slate-900 min-h-screen">
  <main class="max-w-5xl mx-auto px-4 py-8 space-y-6">
    <header class="bg-white rounded-2xl shadow p-5 border border-slate-200">
      <h1 class="text-2xl font-bold text-slate-800">
        Crucigrama – Vocabulario de la salud
      </h1>
      <p class="text-sm text-slate-600 mt-1">
        Completa el crucigrama con vocabulario de <strong>Descubre 2, Lección 1 (la salud/el cuerpo)</strong>.
        Las casillas correctas se pondrán verdes. Algunas casillas especiales se pondrán azules y
        revelarán letras de una <strong>contraseña secreta</strong>.
      </p>
    </header>

    <section class="grid lg:grid-cols-[2fr,1fr] gap-6 items-start">
      <!-- Crossword grid -->
      <div class="bg-white rounded-2xl shadow p-4 border border-slate-200">
        <h2 class="text-lg font-semibold mb-3">Crucigrama</h2>
        <div id="crossword-grid"
             class="grid grid-cols-15 gap-[2px] bg-slate-300 p-[2px] rounded-xl overflow-x-auto">
          <!-- celdas generadas por JS -->
        </div>

        <div class="mt-4 flex flex-wrap items-center gap-3">
          <button id="btn-check"
                  class="px-4 py-2 rounded-lg bg-sky-600 hover:bg-sky-700 text-white text-sm font-semibold">
            Comprobar crucigrama
          </button>
          <p id="crossword-status" class="text-sm text-slate-700"></p>
        </div>
      </div>

      <!-- Clues & secret word -->
      <div class="space-y-4">
        <div class="bg-white rounded-2xl shadow p-4 border border-slate-200">
          <h2 class="text-lg font-semibold mb-2">Pistas</h2>

          <div class="mb-3">
            <h3 class="font-semibold text-slate-800">Horizontales</h3>
            <ul class="mt-1 text-sm text-slate-700 space-y-1">
              <li><strong>1.</strong> Parte física de una persona: tronco, extremidades, etc.</li>
              <li><strong>3.</strong> Parte del cuerpo que une la cabeza con el cuerpo.</li>
              <li><strong>5.</strong> Parte del cuerpo que va desde el hombro hasta la mano.</li>
            </ul>
          </div>

          <div>
            <h3 class="font-semibold text-slate-800">Verticales</h3>
            <ul class="mt-1 text-sm text-slate-700 space-y-1">
              <li><strong>2.</strong> Parte del cuerpo donde están los dientes y la lengua.</li>
              <li><strong>4.</strong> Parte del cuerpo que contiene el cerebro.</li>
              <li><strong>6.</strong> Parte del cuerpo que se extiende desde la cadera hasta el pie.</li>
            </ul>
          </div>
        </div>

        <div class="bg-emerald-50 rounded-2xl shadow p-4 border border-emerald-200">
          <h2 class="text-lg font-semibold text-emerald-900 mb-1">
            Contraseña secreta
          </h2>
          <p class="text-sm text-emerald-800 mb-2">
            Algunas casillas correctas se marcarán en <span class="font-semibold">azul</span>.
            Cada una representa una letra de la contraseña. Cuando completes el crucigrama,
            ordena las letras para formar una palabra relacionada con la salud.
          </p>

          <div class="flex items-center gap-2 mt-2">
            <span class="text-sm font-semibold text-emerald-900">Letras encontradas:</span>
            <div id="secret-word-display" class="flex gap-1">
              <!-- slots generados por JS -->
            </div>
          </div>

          <p id="secret-status" class="text-xs text-emerald-800 mt-2">
            Hay <strong>8</strong> casillas azules en total.
          </p>
        </div>
      </div>
    </section>
  </main>

  <script>
    // ========= CONFIGURACIÓN DEL CRUCIGRAMA =========

    const GRID_ROWS = 15;
    const GRID_COLS = 15;

    // Palabra secreta (no aparece como respuesta)
    const SECRET_WORD = "MEDICINA"; // 8 letras

    // Lista de palabras con coordenadas (0-index) y orientación
    // Todas son del campo semántico salud/cuerpo y se cruzan de verdad.
    const WORDS = [
      {
        id: "A1",
        number: 1,
        direction: "across",
        answer: "CUERPO",
        row: 7,
        col: 4,
        clue: "Parte física de una persona: tronco, extremidades, etc."
      },
      {
        id: "A3",
        number: 3,
        direction: "across",
        answer: "CUELLO",
        row: 4,
        col: 6,
        clue: "Parte del cuerpo que une la cabeza con el cuerpo."
      },
      {
        id: "A5",
        number: 5,
        direction: "across",
        answer: "BRAZO",
        row: 5,
        col: 4,
        clue: "Parte del cuerpo que va desde el hombro hasta la mano."
      },
      {
        id: "D2",
        number: 2,
        direction: "down",
        answer: "BOCA",
        row: 5,
        col: 4,
        clue: "Parte del cuerpo donde están los dientes y la lengua."
      },
      {
        id: "D4",
        number: 4,
        direction: "down",
        answer: "CABEZA",
        row: 4,
        col: 6,
        clue: "Parte del cuerpo que contiene el cerebro."
      },
      {
        id: "D6",
        number: 6,
        direction: "down",
        answer: "PIERNA",
        row: 7,
        col: 8,
        clue: "Parte del cuerpo que se extiende desde la cadera hasta el pie."
      }
    ];

    // Mapa de celdas: clave "r-c" → { answer, secretIndex? }
    const cells = {};

    // Rellenar el mapa con letras de las palabras
    WORDS.forEach(word => {
      const { answer, row, col, direction } = word;
      for (let i = 0; i < answer.length; i++) {
        const r = row + (direction === "down" ? i : 0);
        const c = col + (direction === "across" ? i : 0);
        const key = `${r}-${c}`;
        const ch = answer[i];

        if (!cells[key]) {
          cells[key] = {
            row: r,
            col: c,
            answer: ch,
            // se puede almacenar qué palabras pasan por aquí si se quiere
            words: [word.id],
            secretIndex: null
          };
        } else {
          // Intersección: misma letra, añadir referencia de palabra
          if (cells[key].answer !== ch) {
            console.warn("Conflicto de letras en", key, cells[key].answer, ch);
          }
          cells[key].words.push(word.id);
        }
      }
    });

    // Elegimos 8 celdas concretas para las letras de MEDICINA.
    // (Algunas palabras tendrán 0 casillas azules, otras 2, etc.)
    // Coordenadas basadas en la cuadrícula anterior.
    const SECRET_POSITIONS = [
      { row: 4, col: 8, index: 0 },  // M
      { row: 5, col: 5, index: 1 },  // E
      { row: 5, col: 8, index: 2 },  // D
      { row: 6, col: 4, index: 3 },  // I
      { row: 7, col: 7, index: 4 },  // C
      { row: 8, col: 4, index: 5 },  // I
      { row: 9, col: 6, index: 6 },  // N
      { row: 11, col: 8, index: 7 }  // A
    ];

    SECRET_POSITIONS.forEach(pos => {
      const key = `${pos.row}-${pos.col}`;
      if (cells[key]) {
        cells[key].secretIndex = pos.index;
      }
    });

    // ========= RENDER DEL GRID =========

    const gridContainer = document.getElementById("crossword-grid");

    // Aseguramos 15 columnas en Tailwind (grid-cols-15 no es estándar, así que usamos style)
    gridContainer.style.gridTemplateColumns = `repeat(${GRID_COLS}, minmax(1.5rem, 1fr))`;

    // Creamos las celdas
    for (let r = 0; r < GRID_ROWS; r++) {
      for (let c = 0; c < GRID_COLS; c++) {
        const key = `${r}-${c}`;
        const cellData = cells[key];

        const cellDiv = document.createElement("div");
        cellDiv.className = "relative aspect-square";

        if (!cellData) {
          // Casilla negra
          cellDiv.classList.add("bg-slate-800", "rounded-sm");
        } else {
          // Casilla con letra
          cellDiv.classList.add(
            "bg-white",
            "rounded-sm",
            "border",
            "border-slate-300",
            "flex",
            "items-center",
            "justify-center"
          );

          const input = document.createElement("input");
          input.type = "text";
          input.maxLength = 1;
          input.autocomplete = "off";
          input.className =
            "w-full h-full text-center uppercase text-sm font-semibold focus:outline-none focus:ring-2 focus:ring-sky-400 bg-transparent";
          input.dataset.row = r;
          input.dataset.col = c;
          input.dataset.answer = cellData.answer;

          if (cellData.secretIndex !== null) {
            input.dataset.secretIndex = String(cellData.secretIndex);
          }

          cellDiv.appendChild(input);
        }

        gridContainer.appendChild(cellDiv);
      }
    }

    // ========= SECRET WORD DISPLAY =========

    const secretDisplay = document.getElementById("secret-word-display");
    const secretSlots = [];

    for (let i = 0; i < SECRET_WORD.length; i++) {
      const slot = document.createElement("div");
      slot.className =
        "w-7 h-7 border border-emerald-300 rounded flex items-center justify-center text-sm font-bold text-emerald-900 bg-white";
      slot.textContent = "•";
      secretDisplay.appendChild(slot);
      secretSlots.push(slot);
    }

    // ========= CHECK BUTTON LOGIC =========

    const btnCheck = document.getElementById("btn-check");
    const statusEl = document.getElementById("crossword-status");
    const secretStatusEl = document.getElementById("secret-status");

    btnCheck.addEventListener("click", () => {
      const inputs = gridContainer.querySelectorAll("input[data-answer]");
      let total = 0;
      let correct = 0;
      let blanks = 0;

      // Para no rellenar varias veces la misma letra secreta
      const foundSecret = new Array(SECRET_WORD.length).fill(false);

      inputs.forEach(input => {
        const user = (input.value || "").trim().toUpperCase();
        const answer = (input.dataset.answer || "").toUpperCase();
        const secretIndexStr = input.dataset.secretIndex;

        total++;
        input.classList.remove(
          "bg-emerald-100",
          "bg-red-100",
          "bg-sky-100",
          "border-emerald-500",
          "border-red-500",
          "border-sky-500"
        );

        if (!user) {
          blanks++;
          // dejar blanco visualmente (solo borde gris)
          return;
        }

        if (user === answer) {
          correct++;

          if (secretIndexStr !== undefined) {
            const idx = Number(secretIndexStr);
            input.classList.add("bg-sky-100", "border-sky-500");

            if (!foundSecret[idx]) {
              secretSlots[idx].textContent = SECRET_WORD[idx];
              foundSecret[idx] = true;
            }
          } else {
            input.classList.add("bg-emerald-100", "border-emerald-500");
          }
        } else {
          input.classList.add("bg-red-100", "border-red-500");
        }
      });

      const percent = total ? Math.round((correct / total) * 100) : 0;
      statusEl.textContent = `Correctas: ${correct} de ${total} (${percent} %). Casillas en blanco: ${blanks}.`;

      // Contar cuántas letras secretas están ya visibles
      let revealed = 0;
      secretSlots.forEach((slot, i) => {
        if (slot.textContent === SECRET_WORD[i]) revealed++;
      });

      if (revealed === SECRET_WORD.length) {
        secretStatusEl.innerHTML =
          `✅ Has encontrado todas las letras de la contraseña. ` +
          `La palabra secreta es <strong>${SECRET_WORD}</strong>.`;
      } else {
        secretStatusEl.innerHTML =
          `Has encontrado <strong>${revealed}</strong> de <strong>${SECRET_WORD.length}</strong> letras azules. ` +
          `Sigue completando el crucigrama.`;
      }
    });
  </script>
</body>
</html>

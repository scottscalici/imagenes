<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Crucigrama – Examen del semestre</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-100 min-h-screen">
  <main class="max-w-5xl mx-auto px-4 py-6 space-y-6">
    <header class="flex flex-col sm:flex-row sm:items-baseline sm:justify-between gap-2">
      <div>
        <h1 class="text-2xl font-bold text-slate-800">Crucigrama – Vocabulario</h1>
        <p class="text-sm text-slate-600">
          Completa el crucigrama. Usa mayúsculas o minúsculas (no importa).
        </p>
      </div>
      <p class="text-sm text-slate-500">
        Tema: partes del cuerpo / salud – contraseña secreta de salud
      </p>
    </header>

    <section class="grid md:grid-cols-[minmax(0,2fr),minmax(0,2fr)] gap-6">
      <!-- GRID -->
      <div class="bg-slate-900 rounded-2xl p-3 sm:p-4 shadow-inner">
        <div id="cw-grid"
             class="grid grid-cols-15 gap-0.5 sm:gap-1 justify-center"></div>

        <div class="flex flex-wrap gap-3 mt-4 items-center">
          <button id="btn-check"
                  class="px-4 py-2 rounded-lg bg-sky-600 hover:bg-sky-700 text-white text-sm font-semibold">
            Comprobar respuestas
          </button>
          <button id="btn-clear"
                  class="px-4 py-2 rounded-lg bg-slate-100 text-slate-700 text-sm font-semibold">
            Borrar todo
          </button>
          <p id="cw-status" class="text-sm text-slate-200"></p>
        </div>
      </div>

      <!-- CLUES -->
      <div class="bg-white rounded-2xl shadow p-4 sm:p-5 space-y-4 text-sm">
        <div>
          <h2 class="text-base font-semibold text-slate-800 mb-2">Horizontales</h2>
          <ol class="list-decimal ml-5 space-y-1 text-slate-700">
            <li>Parte del cuerpo donde están la lengua y los dientes.</li>
            <li>Parte del cuerpo que conecta la mano con el hombro.</li>
            <li>Órgano donde se digiere la comida (el ___).</li>
            <li>Lugar donde compras medicina y pastillas.</li>
            <li>Sustancia que tomas para mejorar tu salud.</li>
            <li>Estado general físico y mental de una persona.</li>
            <li>Parte del cuerpo que usas para caminar (entre la cadera y el pie).</li>
          </ol>
        </div>

        <div>
          <h2 class="text-base font-semibold text-slate-800 mb-2">Verticales</h2>
          <ol class="list-decimal ml-5 space-y-1 text-slate-700">
            <li>Parte de la cara que usas para oler.</li>
            <li>Parte del cuerpo que usas para ver (singular).</li>
            <li>Parte del cuerpo al final de la pierna.</li>
            <li>Parte dura dentro del cuerpo; tienes muchos de estos.</li>
            <li>Parte del cuerpo que te duele cuando tienes faringitis.</li>
          </ol>
        </div>
      </div>
    </section>

    <!-- SECRET WORD PANEL -->
    <section class="bg-emerald-50 border border-emerald-200 rounded-2xl p-4 space-y-2">
      <p id="cw-summary" class="text-sm text-emerald-800 font-semibold">
        Tus letras secretas aparecerán aquí a medida que completes el crucigrama.
      </p>
      <p class="text-xs text-emerald-700">
        Cuando todas aparezcan (en orden desordenado), piensa en el tema de
        <strong>la salud</strong> y forma la contraseña.
      </p>
      <div id="secret-letters"
           class="mt-2 flex flex-wrap gap-2 text-lg font-mono text-slate-900"></div>
    </section>
  </main>

  <script>
    // 15x15 grid. Letters = solution, "#" = black square.
    const GRID_TEMPLATE = [
      "BOCA#####N#H#G#",
      "#########A#U#A#",
      "BRAZO####R#E#R#",
      "#########I#S#G#",
      "ESTOMAGO#Z#O#A#",
      "#############N#",
      "FARMACIA##O##T#",
      "##########J##A#",
      "MEDICINA##O####",
      "###############",
      "SALUD#####P####",
      "##########I####",
      "PIERNA####E####",
      "###############",
      "###############"
    ];

    const ROWS = GRID_TEMPLATE.length;
    const COLS = GRID_TEMPLATE[0].length;

    // Secret word = MEDICINA – 8 letters in the horizontal word MEDICINA (row 8, cols 0–7)
    const SECRET_CELLS = [
      { row: 8, col: 0 }, // M
      { row: 8, col: 1 }, // E
      { row: 8, col: 2 }, // D
      { row: 8, col: 3 }, // I
      { row: 8, col: 4 }, // C
      { row: 8, col: 5 }, // I
      { row: 8, col: 6 }, // N
      { row: 8, col: 7 }  // A
    ];

    const SECRET_WORD = "MEDICINA"; // solo referencia

    const gridContainer = document.getElementById("cw-grid");
    const statusEl = document.getElementById("cw-status");
    const summaryEl = document.getElementById("cw-summary");
    const checkBtn = document.getElementById("btn-check");
    const clearBtn = document.getElementById("btn-clear");
    const secretLettersContainer = document.getElementById("secret-letters");

    // 15 columns
    gridContainer.style.gridTemplateColumns = "repeat(15, minmax(0, 1.8rem))";

    // Map "row-col" -> secretIndex (0..7)
    const secretIndexByKey = new Map();
    SECRET_CELLS.forEach((cell, idx) => {
      secretIndexByKey.set(`${cell.row}-${cell.col}`, idx);
    });

    // We'll display the secret letters in a scrambled order.
    const displayIndexBySecret = [];
    function shuffleArray(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    const secretRevealed = Array(SECRET_CELLS.length).fill(false);

    function initSecretSlots() {
      secretLettersContainer.innerHTML = "";
      const indices = shuffleArray([...Array(SECRET_CELLS.length).keys()]);
      indices.forEach((secretIdx, displayIdx) => {
        displayIndexBySecret[secretIdx] = displayIdx;
      });

      for (let displayIdx = 0; displayIdx < SECRET_CELLS.length; displayIdx++) {
        const span = document.createElement("span");
        span.dataset.displayIndex = displayIdx;
        span.className =
          "inline-flex items-center justify-center w-8 h-8 rounded-md border border-emerald-300 bg-white shadow-sm";
        span.textContent = "•";
        secretLettersContainer.appendChild(span);
      }
    }

    // Build crossword grid
    function buildGrid() {
      gridContainer.innerHTML = "";
      for (let r = 0; r < ROWS; r++) {
        for (let c = 0; c < COLS; c++) {
          const ch = GRID_TEMPLATE[r][c];
          const isBlack = ch === "#";

          const cell = document.createElement("div");
          cell.dataset.row = r;
          cell.dataset.col = c;

          if (isBlack) {
            cell.className = "w-7 h-7 sm:w-8 sm:h-8 bg-slate-800 rounded-sm";
          } else {
            const inp = document.createElement("input");
            inp.maxLength = 1;
            inp.dataset.answer = ch;
            inp.dataset.row = r;
            inp.dataset.col = c;
            inp.className =
              "w-7 h-7 sm:w-8 sm:h-8 text-center uppercase text-sm font-semibold " +
              "bg-slate-100 text-slate-900 rounded-sm border border-slate-400 " +
              "focus:outline-none focus:ring-2 focus:ring-sky-400";

            // Mark secret cells with a subtle outline
            if (secretIndexByKey.has(`${r}-${c}`)) {
              inp.classList.add("border-emerald-400");
            }

            cell.appendChild(inp);
          }

          gridContainer.appendChild(cell);
        }
      }
    }

    function resetGrid() {
      document
        .querySelectorAll("#cw-grid input")
        .forEach(inp => {
          inp.value = "";
          inp.classList.remove(
            "bg-emerald-200",
            "bg-emerald-300",
            "bg-blue-300",
            "bg-red-200"
          );
          inp.classList.add("bg-slate-100");
        });
      statusEl.textContent = "";
      summaryEl.textContent =
        "Tus letras secretas aparecerán aquí a medida que completes el crucigrama.";
      summaryEl.classList.remove("text-red-700");
      summaryEl.classList.add("text-emerald-800");
      secretRevealed.fill(false);
      initSecretSlots();
    }

    // Reveal a secret letter slot when its cell is correct
    function revealSecretLetter(row, col, letter) {
      const key = `${row}-${col}`;
      if (!secretIndexByKey.has(key)) return;
      const secretIdx = secretIndexByKey.get(key);
      if (secretRevealed[secretIdx]) return; // already revealed

      secretRevealed[secretIdx] = true;
      const displayIdx = displayIndexBySecret[secretIdx];
      const span = secretLettersContainer.querySelector(
        `[data-display-index="${displayIdx}"]`
      );
      if (span) {
        span.textContent = letter.toUpperCase();
        span.classList.remove("bg-white");
        span.classList.add("bg-emerald-100");
      }
    }

    function checkAnswers() {
      const inputs = Array.from(document.querySelectorAll("#cw-grid input"));
      let total = 0;
      let correct = 0;
      let anyBlank = false;

      inputs.forEach(inp => {
        const ans = (inp.dataset.answer || "").toUpperCase();
        const user = (inp.value || "").toUpperCase().trim();
        const row = Number(inp.dataset.row);
        const col = Number(inp.dataset.col);
        const key = `${row}-${col}`;
        const isSecret = secretIndexByKey.has(key);

        if (!user) {
          anyBlank = true;
          inp.classList.remove(
            "bg-emerald-200",
            "bg-emerald-300",
            "bg-blue-300",
            "bg-red-200"
          );
          inp.classList.add("bg-slate-100");
          return;
        }

        total++;
        if (user === ans) {
          correct++;
          inp.classList.remove("bg-slate-100", "bg-red-200");
          if (isSecret) {
            inp.classList.add("bg-blue-300");
          } else {
            inp.classList.add("bg-emerald-200");
          }
          revealSecretLetter(row, col, ans);
        } else {
          inp.classList.remove("bg-slate-100", "bg-emerald-200", "bg-blue-300");
          inp.classList.add("bg-red-200");
        }
      });

      if (anyBlank) {
        statusEl.textContent =
          "Llena todas las casillas antes de comprobar (las negras se dejan en blanco).";
        return;
      }

      const pct = total ? Math.round((correct / total) * 100) : 0;
      statusEl.textContent = `Correctas: ${correct} de ${total} (${pct} %).`;

      const allSecret = secretRevealed.every(v => v);
      if (allSecret && correct === total) {
        summaryEl.textContent =
          "¡Crucigrama completado! Estas son tus letras secretas (desordenadas). " +
          "Escríbelas, piensa en el tema de la salud y forma la contraseña.";
        summaryEl.classList.remove("text-red-700");
        summaryEl.classList.add("text-emerald-800");
      } else if (allSecret) {
        summaryEl.textContent =
          "Ya tienes todas las letras secretas. Corrige las casillas rojas para completar el crucigrama.";
      } else {
        summaryEl.textContent =
          "Sigue completando el crucigrama. Cada vez que aciertes una letra secreta, aparecerá abajo.";
      }
    }

    // Init
    buildGrid();
    initSecretSlots();
    clearBtn.addEventListener("click", resetGrid);
    checkBtn.addEventListener("click", checkAnswers);
  </script>
</body>
</html>

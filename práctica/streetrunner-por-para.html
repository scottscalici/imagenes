<!doctype html>
<html lang="es">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Por vs Para Runner</title>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
    body {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Arial Black', Arial, sans-serif;
      background: linear-gradient(180deg, #87CEEB 0%, #E0F6FF 100%);
      overflow: hidden;
      height: 100%;
    }

    html {
      height: 100%;
    }

    #game-container {
      position: relative;
      width: 100%;
      height: 100%;
      overflow: hidden;
    }

    #game-header {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      padding: 20px;
      background: rgba(255, 255, 255, 0.9);
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 100;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    #game-title {
      font-size: 28px;
      color: #FF6B35;
      text-shadow: 2px 2px 0px #FFD700;
      margin: 0;
    }

    #score-display {
      font-size: 24px;
      color: #2E86AB;
      font-weight: bold;
    }

    #game-canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }

    .lane-line {
      position: absolute;
      width: 4px;
      height: 100%;
      background: rgba(255, 255, 255, 0.3);
      top: 0;
    }

    /* Mantenemos solo UNA l√≠nea central para dividir los dos carriles */
    #lane-divider {
      position: absolute;
      width: 4px;
      height: 100%;
      background: rgba(255, 255, 255, 0.3);
      top: 0;
      left: 50%; /* Justo en el centro */
      transform: translateX(-50%);
    }

    #player {
      position: absolute;
      width: 60px;
      height: 60px;
      bottom: 120px;
      transition: left 0.2s ease;
      z-index: 50;
      font-size: 50px;
    }

    .obstacle {
      position: absolute;
      width: 200px;
      padding: 15px 20px;
      background: white;
      border: 4px solid #2E86AB;
      border-radius: 15px;
      font-size: 18px;
      font-weight: bold;
      text-align: center;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      cursor: default;
    }

    .obstacle.correct-hit {
        border-color: #06D6A0;
        background: #E8FFF5;
        box-shadow: 0 0 20px #06D6A0;
    }
    
    .obstacle.wrong-hit {
        border-color: #EF476F;
        background: #FFE8ED;
        box-shadow: 0 0 20px #EF476F;
    }

    #start-screen, #game-over-screen {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.85);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 200;
      color: white;
      padding: 40px;
      text-align: center;
    }

    #start-screen h1 {
      font-size: 48px;
      margin: 0 0 20px 0;
      color: #FFD700;
      text-shadow: 3px 3px 0px #FF6B35;
    }

    #instructions {
      font-size: 20px;
      margin: 20px 0 30px 0;
      max-width: 600px;
      line-height: 1.6;
    }

    .btn {
      padding: 15px 40px;
      font-size: 24px;
      font-weight: bold;
      background: #06D6A0;
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      box-shadow: 0 4px 0 #048B6B;
      transition: transform 0.1s;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 0 #048B6B;
    }

    .btn:active {
      transform: translateY(2px);
      box-shadow: 0 2px 0 #048B6B;
    }

    #final-score {
      font-size: 36px;
      margin: 20px 0;
      color: #FFD700;
    }

    .explanation {
      font-size: 16px;
      margin: 10px 0;
      padding: 10px 20px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      max-width: 500px;
    }

    #ground {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 100px;
      background: #8B4513;
      border-top: 5px solid #654321;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }

    #player {
      animation: float 1s ease-in-out infinite;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div id="game-container">
   <div id="game-header">
    <h1 id="game-title">Por vs Para Runner üèÉ</h1>
    <div id="score-display">
      Puntos: <span id="score">0</span>
    </div>
   </div>
   <div id="game-canvas">
    <div id="lane-divider"></div> 
    <div id="ground"></div>
    <div id="player">
     üèÉ
    </div>
   </div>
   <div id="start-screen">
    <h1 id="start-title">Por vs Para Runner</h1>
    <p id="instructions">¬°Corre y elige la palabra correcta! Usa las flechas ‚Üê ‚Üí para moverte entre carriles. **Tu personaje debe estar en el carril de la respuesta correcta antes de que pase.**</p><button class="btn" id="start-btn">¬°Empezar! üöÄ</button>
   </div>
   <div id="game-over-screen" style="display: none;">
    <h1>¬°Juego Terminado!</h1>
    <div id="final-score"></div>
    <div id="explanation-container"></div><button class="btn" id="restart-btn">Jugar de Nuevo üîÑ</button>
   </div>
  </div><script>
    const defaultConfig = {
      game_title: "Por vs Para Runner üèÉ",
      instructions_text: "¬°Corre y elige la palabra correcta! Usa las flechas ‚Üê ‚Üí para moverte entre carriles. **Tu personaje debe estar en el carril de la respuesta correcta antes de que pase.**",
      background_color: "#87CEEB",
      surface_color: "#FFFFFF",
      text_color: "#2E86AB",
      primary_action_color: "#06D6A0",
      secondary_action_color: "#FF6B35"
    };

    let config = {};

    async function onConfigChange(newConfig) {
      config = newConfig;
      
      const gameTitle = newConfig.game_title || defaultConfig.game_title;
      const instructions = newConfig.instructions_text || defaultConfig.instructions_text;
      const bgColor = newConfig.background_color || defaultConfig.background_color;
      const surfaceColor = newConfig.surface_color || defaultConfig.surface_color;
      const textColor = newConfig.text_color || defaultConfig.text_color;
      const primaryColor = newConfig.primary_action_color || defaultConfig.primary_action_color;
      const secondaryColor = newConfig.secondary_action_color || defaultConfig.secondary_action_color;

      document.getElementById('game-title').textContent = gameTitle;
      document.getElementById('start-title').textContent = gameTitle;
      document.getElementById('instructions').innerHTML = instructions;
      document.getElementById('game-container').style.background = `linear-gradient(180deg, ${bgColor} 0%, ${bgColor}dd 100%)`;
      document.getElementById('game-header').style.background = `${surfaceColor}e6`;
      document.getElementById('score-display').style.color = textColor;
      
      const startBtn = document.getElementById('start-btn');
      const restartBtn = document.getElementById('restart-btn');
      startBtn.style.background = primaryColor;
      restartBtn.style.background = primaryColor;
      
      document.getElementById('game-title').style.color = secondaryColor;
      document.getElementById('start-title').style.color = secondaryColor;
    }

    function mapToCapabilities(config) {
      return {
        recolorables: [
          {
            get: () => config.background_color || defaultConfig.background_color,
            set: (value) => {
              config.background_color = value;
              window.elementSdk.setConfig({ background_color: value });
            }
          },
          {
            get: () => config.surface_color || defaultConfig.surface_color,
            set: (value) => {
              config.surface_color = value;
              window.elementSdk.setConfig({ surface_color: value });
            }
          },
          {
            get: () => config.text_color || defaultConfig.text_color,
            set: (value) => {
              config.text_color = value;
              window.elementSdk.setConfig({ text_color: value });
            }
          },
          {
            get: () => config.primary_action_color || defaultConfig.primary_action_color,
            set: (value) => {
              config.primary_action_color = value;
              window.elementSdk.setConfig({ primary_action_color: value });
            }
          },
          {
            get: () => config.secondary_action_color || defaultConfig.secondary_action_color,
            set: (value) => {
              config.secondary_action_color = value;
              window.elementSdk.setConfig({ secondary_action_color: value });
            }
          }
        ],
        borderables: [],
        fontEditable: undefined,
        fontSizeable: undefined
      };
    }

    function mapToEditPanelValues(config) {
      return new Map([
        ["game_title", config.game_title || defaultConfig.game_title],
        ["instructions_text", config.instructions_text || defaultConfig.instructions_text]
      ]);
    }

    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities,
        mapToEditPanelValues
      });
    }

    const questions = [
      // Lista de preguntas (TOTAL: 80)
      { sentence: "Estudio ___ tres horas cada d√≠a", correct: "por", explanation: "Use 'por' for **duration** of time" },
      { sentence: "Este regalo es ___ mi mam√°", correct: "para", explanation: "Use 'para' to indicate **recipient** or **destination**" },
      { sentence: "Viajamos ___ avi√≥n", correct: "por", explanation: "Use 'por' for **means** of transportation" },
      { sentence: "Trabajo ___ ganar dinero", correct: "para", explanation: "Use 'para' to express **purpose/goal** ('in order to')" },
      { sentence: "Caminamos ___ el parque", correct: "por", explanation: "Use 'por' for **movement through/along** a place" },
      { sentence: "La tarea es ___ ma√±ana", correct: "para", explanation: "Use 'para' for **deadlines**" },
      { sentence: "Pagu√© 20 d√≥lares ___ el libro", correct: "por", explanation: "Use 'por' for **price/exchange**" },
      { sentence: "Estudio espa√±ol ___ ser profesor", correct: "para", explanation: "Use 'para' to express **purpose/goal**" },
      { sentence: "Gracias ___ tu ayuda", correct: "por", explanation: "Use 'por' in fixed expressions like 'gracias por'" },
      { sentence: "Salimos ___ Madrid ma√±ana", correct: "para", explanation: "Use 'para' for **destination**" },
      { sentence: "Lo hice ___ ti", correct: "por", explanation: "Use 'por' for **'on behalf of'** or **'because of'**" },
      { sentence: "Necesito el informe ___ el viernes", correct: "para", explanation: "Use 'para' for **deadlines**" },
      { sentence: "___ lo general, me gusta", correct: "por", explanation: "Use 'por' in fixed expressions like 'por lo general'" },
      { sentence: "Esta carta es ___ el director", correct: "para", explanation: "Use 'para' to indicate **recipient**" },
      { sentence: "Hablamos ___ tel√©fono", correct: "por", explanation: "Use 'por' for **means** of communication" },
      { sentence: "Voy a la tienda ___ comprar pan", correct: "para", explanation: "Use 'para' to express **purpose**" },
      { sentence: "Corro ___ el vecindario", correct: "por", explanation: "Use 'por' for **movement through** an area" },
      { sentence: "Este proyecto es ___ el lunes", correct: "para", explanation: "Use 'para' for **deadlines**" },
      { sentence: "Fue escrito ___ Cervantes", correct: "por", explanation: "Use 'por' for the **agent** in passive voice ('by')" },
      { sentence: "Cambi√© mi carro viejo ___ uno nuevo", correct: "por", explanation: "Use 'por' for **exchange**" },
      { sentence: "Estudiamos ___ ser doctores", correct: "para", explanation: "Use 'para' to express **purpose/goal**" },
      { sentence: "Viajo ___ la ma√±ana", correct: "por", explanation: "Use 'por' for general time periods (**time of day**)" },
      { sentence: "Este libro es ___ ni√±os", correct: "para", explanation: "Use 'para' to indicate **intended recipient** (who it is for)" },
      { sentence: "___ m√≠, es dif√≠cil", correct: "para", explanation: "Use 'para' for **opinions/comparison** ('for me,' 'in my opinion')" },
      { sentence: "Pasamos ___ tu casa", correct: "por", explanation: "Use 'por' for **movement by/past** a place" },
      { sentence: "Necesito agua ___ beber", correct: "para", explanation: "Use 'para' to express **purpose**" },
      { sentence: "Te llamo ___ la tarde", correct: "por", explanation: "Use 'por' for general time periods (**time of day**)" },
      { sentence: "Este regalo es ___ ti", correct: "para", explanation: "Use 'para' to indicate **recipient**" },
      { sentence: "Enviamos el paquete ___ correo", correct: "por", explanation: "Use 'por' for **means** of sending" },
      { sentence: "Trabajo ___ una empresa grande", correct: "para", explanation: "Use 'para' for **employer** ('employed by')" },
      { sentence: "Corremos ___ la playa", correct: "por", explanation: "Use 'por' for **movement along/through**" },
      { sentence: "Tengo tarea ___ el martes", correct: "para", explanation: "Use 'para' for **deadlines**" },
      { sentence: "___ favor, ay√∫dame", correct: "por", explanation: "Use 'por' in fixed expressions like 'por favor'" },
      { sentence: "Vamos ___ el bosque", correct: "por", explanation: "Use 'por' for **movement through** a place" },
      { sentence: "Compr√© flores ___ mi abuela", correct: "para", explanation: "Use 'para' to indicate **recipient**" },
      { sentence: "Pagu√© 50 euros ___ la cena", correct: "por", explanation: "Use 'por' for **price/cost**" },
      { sentence: "Ahorro dinero ___ viajar", correct: "para", explanation: "Use 'para' to express **purpose**" },
      { sentence: "Fue construido ___ arquitectos famosos", correct: "por", explanation: "Use 'por' for the **agent** (who did it)" },
      { sentence: "Salgo ___ Chicago el domingo", correct: "para", explanation: "Use 'para' for **destination**" },
      { sentence: "Hablo ___ Zoom con mis amigos", correct: "por", explanation: "Use 'por' for **means** of communication" },
      { sentence: "Ella est√° emocionada ___ la fiesta", correct: "por", explanation: "Use 'por' to express **reason/cause** ('because of')" },
      { sentence: "Necesito un taxi ___ el aeropuerto", correct: "para", explanation: "Use 'para' for **destination**" },
      { sentence: "Mi jefe me contrat√≥ ___ mi experiencia", correct: "por", explanation: "Use 'por' for **reason/cause** ('due to')" },
      { sentence: "El vaso es ___ agua fr√≠a", correct: "para", explanation: "Use 'para' to indicate **intended use/function** ('suitable for')" },
      { sentence: "Tengo que terminar esto ___ el final del d√≠a", correct: "para", explanation: "Use 'para' for **deadlines**" },
      { sentence: "Me gusta pasear ___ la orilla del mar", correct: "por", explanation: "Use 'por' for **movement along** ('along the shore')" },
      { sentence: "Hice la presentaci√≥n ___ mi compa√±ero enfermo", correct: "por", explanation: "Use 'por' for **'on behalf of'**" },
      { sentence: "La medicina es mala ___ el h√≠gado", correct: "para", explanation: "Use 'para' to indicate **standard/comparison** ('in relation to')" },
      { sentence: "Ella canta ___ la radio", correct: "por", explanation: "Use 'por' for **means** ('via the radio')" },
      { sentence: "El tren sale ___ Valencia", correct: "para", explanation: "Use 'para' for **destination**" },
      { sentence: "Me quedar√© aqu√≠ ___ un rato", correct: "por", explanation: "Use 'por' for **duration** of time ('for a while')" },
      { sentence: "El profesor es muy estricto ___ sus estudiantes", correct: "para", explanation: "Use 'para' to indicate **standard/comparison** ('in relation to')" },
      { sentence: "Ella se cay√≥ ___ accidente", correct: "por", explanation: "Use 'por' in fixed expressions like 'por accidente' (**reason**)" },
      { sentence: "Compramos carne ___ asar", correct: "para", explanation: "Use 'para' to express **purpose** ('in order to roast')" },
      { sentence: "La casa est√° ___ vender", correct: "para", explanation: "Use 'para' to indicate **imminent action** ('about to be sold')" },
      { sentence: "El ladr√≥n entr√≥ ___ la ventana", correct: "por", explanation: "Use 'por' for **movement through** ('through the window')" },
      { sentence: "No tengo tiempo ___ ir al cine", correct: "para", explanation: "Use 'para' to express **purpose** ('for the purpose of')" },
      { sentence: "___ aqu√≠ no se ve bien", correct: "por", explanation: "Use 'por' for **place** ('around here')" },
      { sentence: "Yo no puedo vivir ___ aire", correct: "por", explanation: "Use 'por' for **reason/cause** or **'lack of'**" },
      { sentence: "Lo hicimos solo ___ diversi√≥n", correct: "por", explanation: "Use 'por' for **reason/motive** ('for fun')" },
      { sentence: "Este clima es fr√≠o ___ la √©poca del a√±o", correct: "para", explanation: "Use 'para' for **comparison** ('in comparison with')" },
      { sentence: "Dimos un paseo ___ la ciudad", correct: "por", explanation: "Use 'por' for **movement through/around** an area" },
      { sentence: "Necesitas permiso ___ entrar", correct: "para", explanation: "Use 'para' to express **purpose/goal**" },
      { sentence: "Se lo di ___ su cumplea√±os", correct: "por", explanation: "Use 'por' to express **reason/motive** (on account of his birthday)" },
      { sentence: "El libro es importante ___ la historia", correct: "para", explanation: "Use 'para' to indicate **standard/comparison** ('important in relation to history')" },
      { sentence: "Compramos entradas ___ internet", correct: "por", explanation: "Use 'por' for **means** (communication/technology)" },
      // --- Nuevos 13 ejemplos ---
      { sentence: "Estoy a punto de empezar, ___ d√≥nde empezamos?", correct: "por", explanation: "Use 'por' for **starting point/inquiry** ('where do we begin?')" },
      { sentence: "Tienes que estar listo ___ las diez de la ma√±ana", correct: "para", explanation: "Use 'para' for a **specific deadline**" },
      { sentence: "Te doy mi chaqueta ___ tu bufanda", correct: "por", explanation: "Use 'por' for **exchange** (trade-off)" },
      { sentence: "El vaso es ___ agua", correct: "para", explanation: "Use 'para' for **intended use** or function" },
      { sentence: "Me confunden el espa√±ol y el portugu√©s ___ ser parecidos", correct: "por", explanation: "Use 'por' for **reason/cause** ('due to/because of')" },
      { sentence: "Es muy alto ___ su edad", correct: "para", explanation: "Use 'para' for **comparison** or standard ('in comparison to')" },
      { sentence: "√âl se arriesg√≥ ___ salvar a su perro", correct: "por", explanation: "Use 'por' for **motive** or **on behalf of** ('to save')" },
      { sentence: "Ella estudi√≥ mucho ___ tener √©xito", correct: "para", explanation: "Use 'para' to express **purpose** ('in order to have success')" },
      { sentence: "El precio subi√≥ ___ la escasez", correct: "por", explanation: "Use 'por' for **reason/cause** ('due to')" },
      { sentence: "La soluci√≥n es temporal ___ ahora", correct: "por", explanation: "Use 'por' in the fixed expression 'por ahora' (**temporarily**)" },
      { sentence: "Tuvimos que ir al centro ___ la autopista", correct: "por", explanation: "Use 'por' for **path/route** ('via the highway')" },
      { sentence: "Lo dif√≠cil no es la gram√°tica, sino el vocabulario ___ ella", correct: "para", explanation: "Use 'para' for **opinion/comparison** ('in her opinion')" },
      { sentence: "Viven en el pueblo ___ diez a√±os", correct: "por", explanation: "Use 'por' for **duration** of time" },
    ];

    let score = 0;
    let currentLane = 0; // Se inicializa en 0 (Izquierda) o 1 (Derecha)
    let gameActive = false;
    let obstacles = [];
    let lastQuestionIndex = -1; 
    let spawnCounter = 0; 
    
    const BASE_SPAWN_INTERVAL_FRAMES = 240; 
    
    const PLAYER_HIT_LINE = window.innerHeight - 120 - 60; 
    
    const BASE_SPEED = 2; 

    // **Carriles Redefinidos: Solo 2 (Izquierda y Derecha)**
    const lanes = [
      { index: 0, center: window.innerWidth * 0.25 }, // Carril 0 (25% del ancho)
      { index: 1, center: window.innerWidth * 0.75 }  // Carril 1 (75% del ancho)
    ];

    function updatePlayerPosition() {
      const player = document.getElementById('player');
      // Aseguramos que currentLane est√© entre 0 y 1
      currentLane = Math.min(1, Math.max(0, currentLane)); 
      player.style.left = (lanes[currentLane].center - 30) + 'px';
    }

    // L√≥gica de creaci√≥n de obst√°culos con 2 carriles y 2 opciones √∫nicas
    function createObstacle() {
      const availableQuestions = questions.filter((q, index) => index !== lastQuestionIndex);
      
      if (availableQuestions.length === 0) {
          lastQuestionIndex = -1;
          return;
      }
      
      const shuffled = [...availableQuestions].sort(() => Math.random() - 0.5);
      const mainQuestion = shuffled[0];
      
      const mainQuestionIndex = questions.indexOf(mainQuestion);
      lastQuestionIndex = mainQuestionIndex;
      
      const correctAnswer = mainQuestion.correct.toLowerCase();
      
      // La √∫nica palabra incorrecta es la opuesta
      const wrongWord = correctAnswer === 'por' ? 'para' : 'por';
      
      // SOLO DOS OPCIONES GENERADAS (Correcta e Incorrecta)
      const options = [
          { 
              sentence: mainQuestion.sentence, 
              word: correctAnswer, 
              isCorrect: true, 
              explanation: mainQuestion.explanation
          },
          { 
              sentence: mainQuestion.sentence, 
              word: wrongWord, 
              isCorrect: false, 
              explanation: mainQuestion.explanation 
          }
      ];
      
      options.sort(() => Math.random() - 0.5); // Aleatorizar el orden de las dos opciones

      // Bucle para crear SOLO 2 obst√°culos (i=0 para el carril izquierdo, i=1 para el derecho)
      for (let i = 0; i < 2; i++) {
        const obstacle = document.createElement('div');
        obstacle.className = 'obstacle';
        
        const option = options[i];
        
        const isStartOfSentence = option.sentence.trim().startsWith('___');
        const displayWord = isStartOfSentence 
                            ? option.word.charAt(0).toUpperCase() + option.word.slice(1)
                            : option.word;
        
        obstacle.innerHTML = `
          <div style="font-size: 14px; color: #666; margin-bottom: 5px;">
            ${option.sentence.replace('___', '<span style="color: #FF6B35;">___</span>')}
          </div>
          <div style="font-size: 24px; color: #2E86AB;">
            ${displayWord}
          </div>
        `;

        obstacle.style.left = (lanes[i].center - 100) + 'px'; 
        obstacle.style.top = '-150px';
        
        obstacle.dataset.correct = option.isCorrect;
        obstacle.dataset.explanation = option.explanation; 
        obstacle.dataset.mainIndex = mainQuestionIndex;
        obstacle.dataset.lane = i; 
        
        document.getElementById('game-canvas').appendChild(obstacle);
        obstacles.push({ element: obstacle, speed: BASE_SPEED, isCorrect: option.isCorrect, passed: false });
      }
    }


    // Bucle principal del juego (Game Loop)
    function gameLoop() {
      if (!gameActive) return;
      
      // 1. Generaci√≥n de obst√°culos (basado en frames)
      spawnCounter++;
      
      const dynamicSpawnInterval = Math.max(120, BASE_SPAWN_INTERVAL_FRAMES - Math.floor(score * 1.5));
      
      if (spawnCounter >= dynamicSpawnInterval) {
          createObstacle();
          spawnCounter = 0;
      }
      
      // 2. Procesamiento de obst√°culos
      for (let i = obstacles.length - 1; i >= 0; i--) {
        const obs = obstacles[i];
        const element = obs.element;
        const currentTop = parseFloat(element.style.top);
        
        const currentSpeed = BASE_SPEED + (score * 0.005); 
        
        const newTop = currentTop + currentSpeed;
        element.style.top = newTop + 'px';
        
        // --- DETECCI√ìN DE COLISI√ìN (PASO DE L√çNEA) ---
        if (newTop > PLAYER_HIT_LINE && !obs.passed) {
          obs.passed = true;
          const obstacleLane = parseInt(element.dataset.lane);
          
          // Obtener la explicaci√≥n correcta usando el √≠ndice de la pregunta principal de esta oleada
          const failedQuestionIndex = parseInt(element.dataset.mainIndex);
          const correctExplanation = questions[failedQuestionIndex].explanation;

          if (obs.isCorrect) {
            // Condici√≥n de √©xito: Corredor en carril correcto (Acierto)
            if (obstacleLane === currentLane) {
              element.classList.add('correct-hit');
              score += 10;
              document.getElementById('score').textContent = score;
            } else {
              // Condici√≥n de fallo 1: Respuesta correcta, pero el corredor la esquiv√≥ (FALLA)
              element.classList.add('wrong-hit'); 
              endGame(correctExplanation); 
              return; 
            }
          } else {
            // Condici√≥n de fallo 2: Corredor choc√≥ con una respuesta incorrecta (FALLA)
            if (obstacleLane === currentLane) {
              element.classList.add('wrong-hit');
              
              // Resaltar la respuesta correcta (solo visual)
              const correctObstacle = obstacles.find(o => o.isCorrect && !o.passed);
              if (correctObstacle) {
                 correctObstacle.element.classList.add('correct-hit');
              }
              
              endGame(correctExplanation); 
              return; 
            }
          }
        }
        
        // --- LIMPIEZA DE OBST√ÅCULOS ---
        if (newTop > window.innerHeight) {
          if (element.parentNode) {
            element.parentNode.removeChild(element);
          }
          obstacles.splice(i, 1);
        }
      }
      
      requestAnimationFrame(gameLoop);
    }


    function startGame() {
      score = 0;
      currentLane = 0; // Inicia en el carril izquierdo
      gameActive = true;
      obstacles = [];
      lastQuestionIndex = -1;
      spawnCounter = 0; 
      
      document.getElementById('score').textContent = score;
      document.getElementById('start-screen').style.display = 'none';
      document.getElementById('game-over-screen').style.display = 'none';
      
      const oldObstacles = document.querySelectorAll('.obstacle');
      oldObstacles.forEach(obs => obs.remove());
      
      updatePlayerPosition();
      
      createObstacle(); 
      
      requestAnimationFrame(gameLoop); 
    }

    function endGame(explanation) {
      gameActive = false;
      
      document.getElementById('final-score').textContent = `Puntos Finales: ${score}`;
      
      const explanationContainer = document.getElementById('explanation-container');
      explanationContainer.innerHTML = `<div class="explanation">üí° Fallaste. Recuerda: ${explanation}</div>`;
      
      document.getElementById('game-over-screen').style.display = 'flex';
    }

    // **L√≥gica de movimiento ajustada para 2 carriles (0 y 1)**
    document.addEventListener('keydown', (e) => {
      if (!gameActive) return;
      
      if (e.key === 'ArrowLeft' && currentLane > 0) {
        currentLane--;
        updatePlayerPosition();
      } else if (e.key === 'ArrowRight' && currentLane < 1) { // El l√≠mite es 1
        currentLane++;
        updatePlayerPosition();
      }
    });

    document.getElementById('start-btn').addEventListener('click', startGame);
    document.getElementById('restart-btn').addEventListener('click', startGame);

    window.addEventListener('resize', () => {
      lanes[0].center = window.innerWidth * 0.25;
      lanes[1].center = window.innerWidth * 0.75;
      updatePlayerPosition();
    });

    updatePlayerPosition();
  </script>
 </body>
</html>

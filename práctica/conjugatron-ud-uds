<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Conjugatr√≥n 3000 ‚Äì Mandatos formales y plurales</title>

  <style>
    body {
      font-family: sans-serif;
      background-color: #f9f9f9;
      padding: 2rem;
    }
    .output {
      margin-top: 2rem;
      padding: 1rem;
      background: white;
      border-radius: 0.5rem;
      box-shadow: 0 0 10px rgba(0,0,0,0.05);
    }
    input[type="text"] {
      font-size: 1rem;
      padding: 0.4rem;
      margin-top: 0.5rem;
    }
    button {
      padding: 0.5rem 1rem;
      margin-top: 1rem;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>ü§ñ Conjugatr√≥n 3000 (Mandatos formales y plurales)</h1>

  <div style="margin-bottom: 1rem;">
    <p id="score-display" style="font-size: 1.1rem;">Puntuaci√≥n: 0 aciertos de 0 (0%)</p>
  </div>

  <button onclick="mostrarPregunta()">üé≤ Nueva Pregunta</button>
  <div class="output" id="resultado"></div>

  <script>
    let verbos = [];
    let esperandoRespuesta = false;
    let currentCorrectAnswer = "";
    let totalIntentos = 0;
    let respuestasCorrectas = 0;

    // Cargar SOLO el JSON de mandatos formales/plurales
    fetch('https://raw.githubusercontent.com/scottscalici/imagenes/main/verbos/mandatos-formales-y-plurales.json')
      .then(res => res.json())
      .then(data => {
        verbos = data;
        mostrarPregunta();
      })
      .catch(err => {
        document.getElementById("resultado").innerHTML = "‚ùå Error al cargar el archivo JSON.";
        console.error(err);
      });

    function randomItem(array) {
      return array[Math.floor(Math.random() * array.length)];
    }

    function generarPregunta() {
      if (!verbos.length) return null;

      const verbo = randomItem(verbos);
      if (!verbo || !verbo.contexto || !verbo.forma) return null;

      // Usamos el contexto tal cual con el ___
      const fraseConHueco = verbo.contexto;
      const traduccion = verbo.traducci√≥n;

      // persona = "usted" o "ustedes" (primer token del campo sujeto)
      const persona = verbo.sujeto ? verbo.sujeto.split(" ")[0] : "";

      return {
        spanish: fraseConHueco,
        correct: verbo.forma,
        english: traduccion,
        persona: persona,
        infinitivo: verbo.infinitivo,
        tiempo: verbo.tiempo
      };
    }

    function mostrarClave() {
      const claveBox = document.getElementById("clave");
      if (claveBox) claveBox.style.display = "block";
    }

    function actualizarPuntuacion() {
      const porcentaje = totalIntentos === 0
        ? 0
        : Math.round((respuestasCorrectas / totalIntentos) * 100);
      const scoreText = `Puntuaci√≥n: ${respuestasCorrectas} aciertos de ${totalIntentos} (${porcentaje}%)`;
      document.getElementById("score-display").textContent = scoreText;
    }

    function mostrarPregunta() {
      if (!verbos.length) {
        document.getElementById("resultado").innerHTML =
          "üîÑ Cargando datos‚Ä¶ intenta de nuevo en un momento.";
        return;
      }

      const pregunta = generarPregunta();
      if (!pregunta) {
        document.getElementById("resultado").innerHTML =
          "‚ùå No se pudo generar una pregunta. Revisa el archivo JSON.";
        return;
      }

      currentCorrectAnswer = pregunta.correct;
      esperandoRespuesta = true;

      const output = document.getElementById("resultado");
      output.innerHTML = `
        <p><strong>Completa la frase:</strong></p>
        <p>${pregunta.spanish}</p>
        <input type="text" id="respuestaInput" placeholder="Escribe la forma correcta">
        <button onclick="verificarRespuesta()">Verificar</button>
        <button onclick="mostrarClave()" style="margin-left: 1rem;">üß© Ver pista</button>
        <p><em>Traducci√≥n:</em> ${pregunta.english}</p>
        <div id="clave" style="display:none; margin-top:1rem; background:#eef; padding:0.5rem; border-left:4px solid #339;">
          üîë <strong>Clave:</strong> <span id="clave-content"></span>
        </div>
        <div id="feedback"></div>
      `;

      // Clave: usted/ustedes + infinitivo + tiempo
      document.getElementById("clave-content").textContent =
        `${pregunta.persona}, ${pregunta.infinitivo}, ${pregunta.tiempo}`;

      document.getElementById("respuestaInput").focus();
    }

    function verificarRespuesta() {
      const input = document.getElementById("respuestaInput");
      if (!input) return;

      const entrada = input.value.trim().toLowerCase();
      const feedback = document.getElementById("feedback");

      totalIntentos++;

      if (entrada === currentCorrectAnswer.toLowerCase()) {
        respuestasCorrectas++;
        feedback.innerHTML = "‚úÖ ¬°Correcto! Presiona Enter o ‚Üí para continuar.";
        feedback.style.color = "green";
      } else {
        feedback.innerHTML =
          `‚ùå Incorrecto. La respuesta correcta es: <strong>${currentCorrectAnswer}</strong><br>Presiona Enter o ‚Üí para continuar.`;
        feedback.style.color = "red";
      }

      esperandoRespuesta = false;
      actualizarPuntuacion();
    }

    // Atajo de teclado: Enter / flecha derecha
    document.addEventListener("keydown", function(event) {
      if (event.key === "Enter" || event.key === "ArrowRight") {
        if (esperandoRespuesta) {
          verificarRespuesta();
        } else {
          mostrarPregunta();
        }
      }
    });
  </script>

</body>
</html>

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Sr. Scalici - Factory v3</title>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; padding: 20px; color: #333; }
        .factory-box { max-width: 900px; margin: auto; background: white; padding: 25px; border-radius: 12px; border: 3px solid #3498db; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .section { margin-bottom: 20px; padding: 15px; border: 1px solid #eee; border-radius: 8px; }
        h3 { margin-top: 0; color: #2c3e50; border-bottom: 2px solid #3498db; display: inline-block; }
        .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; }
        .checkbox-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 10px; margin-top: 10px; }
        input[type="text"], select { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        .output-area { background: #2c3e50; color: #7fdbff; padding: 15px; border-radius: 5px; height: 150px; overflow-y: auto; font-family: monospace; white-space: pre-wrap; margin-top: 15px; font-size: 12px; border: 4px solid #1a252f; }
        button.gen-btn { background: #27ae60; color: white; padding: 15px; width: 100%; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; font-size: 1.1rem; }
        .label-text { font-weight: bold; font-size: 0.9rem; display: block; margin-bottom: 5px; }
    </style>
</head>
<body>

<div class="factory-box">
    <h2>üõ†Ô∏è Creador de Lecciones v3</h2>
    
    <div class="section">
        <h3>1. Contenido Base</h3>
        <label class="label-text">Link de GitHub:</label>
        <input type="text" id="ghLink" placeholder="https://github.com/.../foto.jpg">
        <div class="grid-3" style="margin-top:10px;">
            <div>
                <label class="label-text">Tema IB:</label>
                <select id="theme">
                    <option value="sharing">Compartimos el planeta</option>
                    <option value="identities">Identidades</option>
                    <option value="experiences">Experiencias</option>
                    <option value="ingenuity">Ingenio humano</option>
                    <option value="organization">Organizaci√≥n social</option>
                </select>
            </div>
            <div>
                <label class="label-text">Nivel Inicial:</label>
                <select id="tier">
                    <option value="1">Tier 1: 30s</option>
                    <option value="5">Tier 5: 1.75m</option>
                    <option value="10" selected>Tier 10: 4m</option>
                </select>
            </div>
            <div>
                <label class="label-text">Otros Temas/Vocab:</label>
                <input type="text" id="otherTopics" placeholder="ej: Medio ambiente, Salud">
            </div>
        </div>
    </div>

    <div class="section">
        <h3>2. Enfoque Gramatical</h3>
        <div class="checkbox-grid" id="verbCheckboxes">
            <label><input type="checkbox" value="Presente"> Presente</label>
            <label><input type="checkbox" value="Pret√©rito"> Pret√©rito</label>
            <label><input type="checkbox" value="Imperfecto"> Imperfecto</label>
            <label><input type="checkbox" value="Subjuntivo"> Subjuntivo</label>
            <label><input type="checkbox" value="Condicional"> Condicional</label>
            <label><input type="checkbox" value="Futuro"> Futuro</label>
            <label><input type="checkbox" value="Por vs Para"> Por vs Para</label>
            <label><input type="checkbox" value="Ser vs Estar"> Ser vs Estar</label>
            <label><input type="checkbox" value="Mandatos"> Mandatos</label>
            <label><input type="checkbox" value="Perfecto"> Perfecto</label>
        </div>
    </div>

    <button class="gen-btn" onclick="generateHTML()">Generar C√≥digo de Lecci√≥n</button>

    <div class="output-area" id="output">El c√≥digo aparecer√° aqu√≠...</div>
</div>

<script>
function toRaw(url) {
    return url.replace('github.com', 'raw.githubusercontent.com').replace('/blob/', '/');
}

function generateHTML() {
    const img = toRaw(document.getElementById('ghLink').value);
    const tier = document.getElementById('tier').value;
    const theme = document.getElementById('theme').value;
    const others = document.getElementById('otherTopics').value;
    
    let selectedVerbs = [];
    document.querySelectorAll('#verbCheckboxes input:checked').forEach(cb => selectedVerbs.push(cb.value));
    if(others) selectedVerbs.push(others);

    const config = {
        1: { time: 30, bullets: 50, prep: 7 },
        5: { time: 105, bullets: 10, prep: 12 },
        10: { time: 240, bullets: 10, prep: 15 }
    }[tier] || { time: 240, bullets: 10, prep: 15 };

    const studentHTML = `
<!DOCTYPE html>
<html>
<head>
<style>
    body { font-family: 'Segoe UI', sans-serif; background: #fff; color: #2c3e50; margin: 10px; }
    .header { background: #2c3e50; color: white; padding: 15px; border-radius: 8px; margin-bottom: 15px; }
    .grid { display: grid; grid-template-columns: 1.2fr 0.8fr; gap: 20px; }
    .btn { cursor: pointer; border: none; padding: 12px; border-radius: 6px; font-weight: bold; color: white; background: #3498db; width: 100%; transition: 0.2s; margin-bottom: 5px; }
    .btn-sim { background: #9b59b6; } .btn:hover { opacity: 0.9; }
    .timer { font-size: 3.5rem; font-weight: bold; text-align: center; margin: 10px 0; transition: color 0.3s; }
    .overtime { color: #e74c3c; animation: blink 1s infinite; }
    @keyframes blink { 50% { opacity: 0.7; } }
    .notes { border: 2px solid #eee; padding: 15px; border-radius: 8px; background: #fdfdfd; min-height: 400px; }
    .tag { background: #f0f2f5; padding: 4px 10px; border-radius: 12px; font-size: 0.85rem; border: 1px solid #ccc; margin: 2px; display: inline-block; }
    .hidden { display: none; }
</style>
</head>
<body>
    <div class="header">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <span>üéØ Objetivo: ${config.time}s | Prep: ${config.prep}m</span>
            <button class="btn btn-sim" style="width:auto; margin:0;" onclick="forceSimulation()">‚ö†Ô∏è Modo Simulaci√≥n Total</button>
        </div>
        <div style="margin-top:10px;">${selectedVerbs.map(v => '<span class="tag">' + v + '</span>').join('')}</div>
    </div>

    <div class="grid">
        <div id="leftCol">
            <img src="${img}" style="width:100%; border-radius:8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            <div id="clock" class="timer">00:00</div>
            <button id="mainBtn" class="btn" onclick="startPrep()">Empezar Preparaci√≥n</button>
        </div>
        <div id="rightCol">
            <div class="notes" id="notesArea">
                <p style="color:#7f8c8d; font-style:italic; text-align:center;">Las instrucciones aparecer√°n al iniciar prep.</p>
            </div>
        </div>
    </div>

    <div id="qZone" class="hidden" style="margin-top:20px; text-align:center; border-top: 2px solid #eee; padding-top:20px;">
        <div id="qDisplay" style="font-weight:bold; margin-bottom:15px; font-size:1.3rem; min-height:1.5em; color:#2c3e50;"></div>
        <div style="display:flex; gap:10px; justify-content:center;">
            <button class="btn" style="background:#27ae60; width:auto;" onclick="ask(1)">Nivel 1</button>
            <button class="btn" style="background:#f39c12; width:auto;" onclick="ask(2)">Nivel 2</button>
            <button class="btn" style="background:#e74c3c; width:auto;" onclick="ask(3)">Nivel 3</button>
        </div>
    </div>

    <script>
    let seconds = 0; let loop; let goal = ${config.time}; let isSim = false;
    const questions = {
        sharing: { 1:["¬øQu√© es lo m√°s importante que ves?"], 2:["¬øC√≥mo afecta esto a tu comunidad?"], 3:["¬øQu√© soluci√≥n global propones?"] },
        identities: { 1:["¬øC√≥mo van vestidos?"], 2:["¬øC√≥mo influye esto en su identidad?"], 3:["¬øLa cultura se pierde con el tiempo?"] },
        experiences: { 1:["¬øQu√© actividad hacen?"], 2:["¬øLo has hecho antes?"], 3:["¬øPor qu√© es importante viajar?"] },
        ingenuity: { 1:["¬øQu√© tecnolog√≠a ves?"], 2:["¬øC√≥mo facilita la vida?"], 3:["¬øTiene riesgos este invento?"] },
        organization: { 1:["¬øQui√©nes son?"], 2:["¬øC√≥mo es la escuela/trabajo all√≠?"], 3:["¬øEl individuo es m√°s importante que el grupo?"] }
    };

    function forceSimulation() {
        if(!confirm("¬øQuieres cambiar a modo simulaci√≥n? (15m prep / 4m habla)")) return;
        isSim = true; goal = 240;
        document.getElementById('clock').innerText = "15:00";
        alert("Modo Simulaci√≥n Activado.");
    }

    function buildBullets() {
        const area = document.getElementById('notesArea');
        const bCount = isSim ? 10 : ${config.bullets};
        area.innerHTML = "<strong>Instrucciones:</strong><br>1. Escribe hasta <strong>"+bCount+" balas</strong>.<br>2. Escribe <strong>una pregunta</strong> para tu grupo.<br><hr>";
        for(let i=1; i<=bCount; i++) area.innerHTML += "<div style='margin-bottom:8px;'>"+i+". <input type='text' style='width:85%; border:none; border-bottom:1px solid #ccc; outline:none;'></div>";
        area.innerHTML += "<br><strong>Tu Pregunta:</strong><br><textarea style='width:95%; height:50px;'></textarea>";
    }

    function startPrep() {
        seconds = isSim ? 900 : ${config.prep} * 60;
        document.getElementById('mainBtn').innerText = "¬°Listo para Hablar!";
        document.getElementById('mainBtn').onclick = startSpeaking;
        loop = setInterval(() => {
            seconds--;
            updateClock(true);
            if(seconds <= 0) startSpeaking();
        }, 1000);
        buildBullets();
    }

    function startSpeaking() {
        clearInterval(loop);
        seconds = goal;
        document.getElementById('mainBtn').innerText = "Terminar y Preguntas";
        document.getElementById('mainBtn').onclick = endAll;
        loop = setInterval(() => {
            seconds--;
            updateClock(false);
        }, 1000);
    }

    function updateClock(isPrep) {
        const el = document.getElementById('clock');
        let absSec = Math.abs(seconds);
        let m = Math.floor(absSec / 60);
        let s = absSec % 60;
        el.innerText = (seconds < 0 ? "-" : "") + m + ":" + (s < 10 ? '0' : '') + s;
        if(!isPrep && seconds < 0) el.classList.add('overtime');
    }

    function endAll() {
        clearInterval(loop);
        document.getElementById('qZone').classList.remove('hidden');
    }

    function ask(lvl) {
        const bank = questions['${theme}'][lvl];
        document.getElementById('qDisplay').innerText = bank[Math.floor(Math.random()*bank.length)];
    }
    <\/script>
</body>
</html>\`;

    document.getElementById('output').innerText = studentHTML;
}
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Sr. Scalici - Factory v4 (Full 10 Tiers)</title>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; padding: 20px; color: #333; }
        .factory-box { max-width: 900px; margin: auto; background: white; padding: 25px; border-radius: 12px; border: 3px solid #3498db; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .section { margin-bottom: 20px; padding: 15px; border: 1px solid #eee; border-radius: 8px; }
        .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; }
        .checkbox-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 10px; margin-top: 10px; }
        input[type="text"], select { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        .output-area { background: #2c3e50; color: #7fdbff; padding: 15px; border-radius: 5px; height: 180px; overflow-y: auto; font-family: monospace; white-space: pre-wrap; margin-top: 15px; font-size: 12px; border: 4px solid #1a252f; }
        button.gen-btn { background: #27ae60; color: white; padding: 15px; width: 100%; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; font-size: 1.1rem; }
    </style>
</head>
<body>

<div class="factory-box">
    <h2>üõ†Ô∏è Creador de Lecciones v4</h2>
    
    <div class="section">
        <h3>1. Contenido Base</h3>
        <label>Link de GitHub:</label>
        <input type="text" id="ghLink" placeholder="https://github.com/.../foto.jpg">
        <div class="grid-3" style="margin-top:10px;">
            <div>
                <label>Tema IB:</label>
                <select id="theme">
                    <option value="sharing">Compartimos el planeta</option>
                    <option value="identities">Identidades</option>
                    <option value="experiences">Experiencias</option>
                    <option value="ingenuity">Ingenio humano</option>
                    <option value="organization">Organizaci√≥n social</option>
                </select>
            </div>
            <div>
                <label>Nivel (Tier):</label>
                <select id="tier">
                    <option value="1">Tier 1: 30s</option>
                    <option value="2">Tier 2: 45s</option>
                    <option value="3">Tier 3: 1m</option>
                    <option value="4">Tier 4: 1.5m</option>
                    <option value="5">Tier 5: 1.75m</option>
                    <option value="6">Tier 6: 2m</option>
                    <option value="7">Tier 7: 2.5m</option>
                    <option value="8">Tier 8: 3m</option>
                    <option value="9">Tier 9: 3.5m</option>
                    <option value="10">Tier 10: 4m</option>
                </select>
            </div>
            <div>
                <label>Otros Temas:</label>
                <input type="text" id="otherTopics" placeholder="ej: Medio ambiente">
            </div>
        </div>
    </div>

    <div class="section">
        <h3>2. Enfoque Gramatical</h3>
        <div class="checkbox-grid" id="verbCheckboxes">
            <label><input type="checkbox" value="Presente"> Presente</label>
            <label><input type="checkbox" value="Pret√©rito"> Pret√©rito</label>
            <label><input type="checkbox" value="Imperfecto"> Imperfecto</label>
            <label><input type="checkbox" value="Subjuntivo"> Subjuntivo</label>
            <label><input type="checkbox" value="Condicional"> Condicional</label>
            <label><input type="checkbox" value="Futuro"> Futuro</label>
            <label><input type="checkbox" value="Por vs Para"> Por vs Para</label>
            <label><input type="checkbox" value="Ser vs Estar"> Ser vs Estar</label>
        </div>
    </div>

    <button class="gen-btn" onclick="generateHTML()">Generar C√≥digo de Lecci√≥n</button>
    <div class="output-area" id="output">El c√≥digo aparecer√° aqu√≠...</div>
</div>

<script>
function toRaw(url) {
    return url.replace('github.com', 'raw.githubusercontent.com').replace('/blob/', '/');
}

function generateHTML() {
    const img = toRaw(document.getElementById('ghLink').value);
    const tier = document.getElementById('tier').value;
    const theme = document.getElementById('theme').value;
    const others = document.getElementById('otherTopics').value;
    
    let selectedVerbs = [];
    document.querySelectorAll('#verbCheckboxes input:checked').forEach(cb => selectedVerbs.push(cb.value));
    if(others) selectedVerbs.push(others);

    const tierConfig = {
        1: { prep: 7, goal: 30, bullets: 50, script: true },
        2: { prep: 7, goal: 45, bullets: 50, script: true },
        3: { prep: 10, goal: 60, bullets: 50 },
        4: { prep: 10, goal: 90, bullets: 12 },
        5: { prep: 10, goal: 105, bullets: 10 },
        6: { prep: 10, goal: 120, bullets: 5, qReq: true },
        7: { prep: 10, goal: 150, bullets: 0, qReq: true },
        8: { prep: 15, goal: 180, bullets: 10 },
        9: { prep: 15, goal: 210, bullets: 10 },
        10: { prep: 15, goal: 240, bullets: 10 }
    }[tier];

    const studentHTML = `
<!DOCTYPE html>
<html>
<head>
<style>
    body { font-family: sans-serif; margin: 15px; color: #2c3e50; }
    .header { background: #2c3e50; color: white; padding: 15px; border-radius: 8px; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; }
    .grid { display: grid; grid-template-columns: 1.2fr 0.8fr; gap: 20px; }
    .timer { font-size: 3.5rem; font-weight: bold; text-align: center; margin: 10px 0; }
    .overtime { color: #e74c3c; }
    .notes { border: 2px solid #eee; padding: 15px; border-radius: 8px; min-height: 400px; background: #fafafa; }
    .btn { cursor: pointer; border: none; padding: 12px; border-radius: 6px; font-weight: bold; color: white; background: #3498db; width: 100%; margin-bottom: 5px; }
    .tag { background: #f0f2f5; padding: 4px 10px; border-radius: 12px; font-size: 0.85rem; border: 1px solid #ccc; margin-right: 5px; color: #2c3e50; }
    .hidden { display: none; }
</style>
</head>
<body>
    <div class="header">
        <div>
            <strong>üéØ Objetivo: ${tierConfig.goal}s</strong> | Prep: ${tierConfig.prep}m<br>
            <div style="margin-top:5px;">${selectedVerbs.map(v => '<span class="tag">' + v + '</span>').join('')}</div>
        </div>
        <button class="btn" style="background:#9b59b6; width:auto;" onclick="forceSim()">‚ö†Ô∏è Modo Simulaci√≥n</button>
    </div>

    <div class="grid">
        <div>
            <img src="${img}" style="width:100%; border-radius:8px;">
            <div id="clock" class="timer">00:00</div>
            <button id="mainBtn" class="btn" onclick="startPrep()">Empezar Preparaci√≥n</button>
        </div>
        <div class="notes" id="notesArea">
            <p style="text-align:center; color:#7f8c8d;">Haz clic en empezar para ver instrucciones.</p>
        </div>
    </div>

    <div id="qZone" class="hidden" style="margin-top:20px; text-align:center; border-top: 2px solid #eee; padding-top:20px;">
        <div id="qDisplay" style="font-weight:bold; margin-bottom:15px; font-size:1.3rem;"></div>
        <button class="btn" style="background:#27ae60; width:auto;" onclick="ask(1)">Nivel 1</button>
        <button class="btn" style="background:orange; width:auto;" onclick="ask(2)">Nivel 2</button>
        <button class="btn" style="background:red; width:auto;" onclick="ask(3)">Nivel 3</button>
    </div>

    <script>
    let seconds = 0; let loop; let goal = ${tierConfig.goal}; let isSim = false;
    const qBank = {
        sharing: { 1:["¬øQu√© ves?"], 2:["¬øHay este problema en tu casa?"], 3:["¬øQu√© soluci√≥n propones?"] },
        identities: { 1:["¬øC√≥mo van vestidos?"], 2:["¬øC√≥mo define esto su identidad?"], 3:["¬øAfecta la globalizaci√≥n?"] },
        experiences: { 1:["¬øQu√© actividad hacen?"], 2:["¬øHas hecho algo similar?"], 3:["¬øPor qu√© importa viajar?"] },
        ingenuity: { 1:["¬øQu√© tecnolog√≠a ves?"], 2:["¬øC√≥mo facilita la vida?"], 3:["¬øTiene riesgos?"] },
        organization: { 1:["¬øQui√©nes son?"], 2:["¬øC√≥mo es en tu pa√≠s?"], 3:["¬øIndividuo vs Sociedad?"] }
    };

    function forceSim() { isSim = true; goal = 240; alert("Simulaci√≥n Activada: 15m prep / 4m habla."); }

    function buildNotes() {
        const area = document.getElementById('notesArea');
        const count = isSim ? 10 : ${tierConfig.bullets};
        area.innerHTML = "<strong>Instrucciones:</strong><br>Escribe hasta <strong>"+count+" balas</strong> y una pregunta para tu grupo.<hr>";
        if(${tier} == 7 && !isSim) { area.innerHTML = "<strong>Nivel 7: Sin balas.</strong> Escribe tu pregunta abajo.<hr>"; }
        for(let i=1; i<=count; i++) area.innerHTML += "<div>"+i+". <input type='text' style='width:85%; border:none; border-bottom:1px solid #ddd; outline:none; margin-bottom:5px;'></div>";
        area.innerHTML += "<br><strong>Tu Pregunta:</strong><br><textarea style='width:95%; height:50px;'></textarea>";
    }

    function startPrep() {
        seconds = (isSim ? 15 : ${tierConfig.prep}) * 60;
        document.getElementById('mainBtn').innerText = "¬°Listo para Hablar!";
        document.getElementById('mainBtn').onclick = startSpeaking;
        buildNotes();
        loop = setInterval(() => { seconds--; updateClock(); if(seconds<=0) startSpeaking(); }, 1000);
    }

    function startSpeaking() {
        clearInterval(loop); seconds = goal;
        document.getElementById('mainBtn').innerText = "Terminar";
        document.getElementById('mainBtn').onclick = () => { clearInterval(loop); document.getElementById('qZone').classList.remove('hidden'); };
        loop = setInterval(() => { seconds--; updateClock(); }, 1000);
    }

    function updateClock() {
        const el = document.getElementById('clock');
        let abs = Math.abs(seconds);
        el.innerText = (seconds < 0 ? "-" : "") + Math.floor(abs/60) + ":" + (abs%60 < 10 ? '0' : '') + abs%60;
        if(seconds < 0) el.classList.add('overtime');
    }

    function ask(lvl) { document.getElementById('qDisplay').innerText = qBank['${theme}'][lvl][0]; }
    <\/script>
</body>
</html>`;
    document.getElementById('output').innerText = studentHTML;
}
</script>
</body>
</html>

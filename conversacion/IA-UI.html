<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Sr. Scalici - IA Generator</title>
    <style>
        :root { --primary: #2c3e50; --accent: #3498db; --success: #27ae60; --light: #ecf0f1; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--light); padding: 20px; }
        .factory-panel { background: #fff; padding: 20px; border-radius: 12px; border: 3px solid var(--accent); margin-bottom: 20px; }
        .student-view { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .hidden { display: none !important; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .timer { font-size: 3.5rem; font-weight: bold; text-align: center; color: var(--primary); }
        .notes-area { border: 1px solid #ddd; padding: 15px; border-radius: 8px; height: 400px; overflow-y: auto; background: #fafafa; }
        .btn { cursor: pointer; border: none; padding: 12px; border-radius: 6px; font-weight: bold; color: white; }
        .btn-launch { background: var(--success); width: 100%; margin-top: 10px; }
        .mission-header { background: #e8f4fd; padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 8px solid var(--accent); }
        .verb-tag { display: inline-block; background: #eee; padding: 4px 10px; border-radius: 15px; margin: 5px; font-size: 0.8rem; border: 1px solid #ccc; }
    </style>
</head>
<body>

<div id="factory" class="factory-panel">
    <h2>üõ†Ô∏è Generador de Enlaces para Estudiantes</h2>
    <p>Configura la sesi√≥n y copia el URL de la barra de direcciones para d√°rselo a los alumnos.</p>
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
        <input type="text" id="ghUrl" placeholder="Link de GitHub (blob)..." oninput="updateLink()">
        <select id="tSelect" onchange="updateLink()">
            <option value="1">Tier 1-2 (Guion)</option>
            <option value="5">Tier 5 (10 Balas)</option>
            <option value="10">Tier 10 (IB Sim)</option>
        </select>
        <select id="themeSelect" onchange="updateLink()">
            <option value="sharing">Compartimos el planeta</option>
            <option value="identities">Identidades</option>
            <option value="experiences">Experiencias</option>
        </select>
        <input type="text" id="verbs" placeholder="Verbos (ej: Subjuntivo, Pret√©rito...)" oninput="updateLink()">
    </div>
    <div style="margin-top:20px; padding:10px; background:#eee; word-break: break-all;" id="finalUrl">URL para estudiantes aparecer√° aqu√≠...</div>
</div>

<div id="product" class="student-view hidden">
    <div class="mission-header">
        <div id="mText"></div>
        <div id="vText" style="margin-top:10px;"></div>
    </div>
    <div class="grid">
        <div>
            <img id="stimulus" style="width:100%; border-radius:8px;">
            <div class="timer" id="clock">00:00</div>
            <button id="actBtn" class="btn btn-launch" onclick="handleLogic()">Empezar Preparaci√≥n</button>
        </div>
        <div class="notes-area" id="notes"></div>
    </div>
    <div id="qZone" class="hidden" style="margin-top:20px; text-align:center;">
        <div id="qText" style="font-weight:bold; font-size:1.2rem; margin-bottom:15px;"></div>
        <button class="btn" style="background:var(--success)" onclick="ask(1)">Nivel 1</button>
        <button class="btn" style="background:orange" onclick="ask(2)">Nivel 2</button>
        <button class="btn" style="background:red" onclick="ask(3)">Nivel 3</button>
    </div>
</div>

<script>
// RAW CONVERSION: github.com/.../blob/... -> raw.githubusercontent.com/.../...
function toRaw(url) {
    return url.replace('github.com', 'raw.githubusercontent.com').replace('/blob/', '/');
}

function updateLink() {
    const params = new URLSearchParams();
    params.set('img', toRaw(document.getElementById('ghUrl').value));
    params.set('tier', document.getElementById('tSelect').value);
    params.set('theme', document.getElementById('themeSelect').value);
    params.set('v', document.getElementById('verbs').value);
    params.set('view', 'student');
    const fullLink = window.location.origin + window.location.pathname + '?' + params.toString();
    document.getElementById('finalUrl').innerText = fullLink;
}

// ON LOAD: CHECK IF STUDENT VIEW
const urlParams = new URLSearchParams(window.location.search);
if (urlParams.get('view') === 'student') {
    document.getElementById('factory').classList.add('hidden');
    document.getElementById('product').classList.remove('hidden');
    document.getElementById('stimulus').src = urlParams.get('img');
    document.getElementById('mText').innerText = "Tier " + urlParams.get('tier') + ": " + (urlParams.get('tier') == 10 ? "Simulaci√≥n Completa" : "Pr√°ctica");
    
    // Process Verbs
    const vList = urlParams.get('v').split(',');
    vList.forEach(v => {
        if(v) document.getElementById('vText').innerHTML += `<span class="verb-tag">üéØ Incluye: ${v.trim()}</span>`;
    });

    // Build Bullets
    const n = document.getElementById('notes');
    let limit = urlParams.get('tier') >= 5 ? 10 : 20;
    for(let i=1; i<=limit; i++) n.innerHTML += `<div>${i}. <input type="text" style="width:85%; border:none; border-bottom:1px solid #ddd; margin-bottom:10px;"></div>`;
}

// Logic for Timers and Questions would go here as per previous versions
</script>
</body>
</html>

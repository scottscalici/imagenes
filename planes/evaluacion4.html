<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Evaluaciones - Español IB</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .timeline-line::before {
            content: '';
            position: absolute;
            left: 20px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #e2e8f0;
        }
    </style>
</head>

<body class="bg-slate-50 text-slate-900 min-h-screen pb-20">
<main class="max-w-4xl mx-auto px-4 py-12 space-y-8">

    <header class="bg-emerald-600 rounded-2xl p-8 text-white shadow-lg flex justify-between items-end">
      <div>
        <h1 class="text-4xl font-black tracking-tight uppercase">Evaluaciones</h1>
        <p id="courseTitle" class="text-lg italic opacity-90 font-medium">IB Español B II (S4)</p>
      </div>
      <div class="text-right">
        <div class="text-3xl font-bold" id="totalCount">0</div>
        <div class="text-[10px] uppercase font-black tracking-widest opacity-70">Pruebas Totales</div>
      </div>
    </header>

    <div class="flex gap-4 overflow-x-auto pb-2">
        <span class="flex items-center gap-2 text-xs font-bold uppercase text-slate-500 bg-white px-4 py-2 rounded-full border border-slate-200 shadow-sm">
            <span class="w-3 h-3 rounded-full bg-emerald-500"></span> Próxima
        </span>
        <span class="flex items-center gap-2 text-xs font-bold uppercase text-slate-500 bg-white px-4 py-2 rounded-full border border-slate-200 shadow-sm">
            <span class="w-3 h-3 rounded-full bg-slate-300"></span> Pasada
        </span>
    </div>

    <div id="evalTimeline" class="relative space-y-8 timeline-line pl-12 pr-4">
        </div>

</main>

<script>
  const CONFIG = {
    COURSE: "s4", // Change to "s2" for Sophomores
    EVALS_URL: "https://raw.githubusercontent.com/scottscalici/imagenes/main/planes/evaluaciones.json",
    // We get current day from URL or default to 1 (for testing display)
    CURRENT_DAY: parseInt(new URLSearchParams(window.location.search).get('dia')) || 35 
  };

  async function init() {
    try {
      const response = await fetch(CONFIG.EVALS_URL + "?t=" + Date.now());
      const data = await response.json();
      const rawEvals = data.courses[CONFIG.COURSE] || [];
      
      // Sort evaluations by day
      const sortedEvals = rawEvals.sort((a, b) => a.dia - b.dia);
      
      document.getElementById('totalCount').textContent = sortedEvals.length;
      renderTimeline(sortedEvals);
    } catch (e) {
      console.error("Error loading evaluations", e);
    }
  }

  function renderTimeline(evals) {
    const container = document.getElementById('evalTimeline');
    container.innerHTML = "";

    evals.forEach(ev => {
      const isPast = ev.dia < CONFIG.CURRENT_DAY;
      const isToday = ev.dia === CONFIG.CURRENT_DAY;
      const isUpcoming = ev.dia > CONFIG.CURRENT_DAY && ev.dia <= CONFIG.CURRENT_DAY + 5;

      // Card Styling based on status
      let dotColor = "bg-slate-300";
      let borderColor = "border-slate-200";
      let titleColor = "text-slate-700";
      let opacity = "opacity-100";

      if (isToday || isUpcoming) {
        dotColor = "bg-emerald-500 ring-4 ring-emerald-100";
        borderColor = "border-emerald-500 border-l-[6px]";
        titleColor = "text-emerald-700";
      } else if (isPast) {
        opacity = "opacity-60";
      }

      container.innerHTML += `
        <div class="relative transition-all hover:scale-[1.01] ${opacity}">
          <div class="absolute -left-[52px] top-6 w-10 h-10 rounded-full ${dotColor} flex items-center justify-center border-4 border-slate-50 z-10">
             <span class="text-white text-[10px] font-black">${ev.dia}</span>
          </div>

          <div class="bg-white rounded-xl border ${borderColor} p-6 shadow-sm">
            <div class="flex justify-between items-start mb-2">
              <span class="text-[10px] font-black uppercase tracking-widest text-slate-400">Día ${ev.dia}</span>
              ${isToday ? '<span class="bg-red-100 text-red-600 text-[10px] font-black px-2 py-1 rounded">HOY</span>' : ''}
              ${isUpcoming ? '<span class="bg-emerald-100 text-emerald-600 text-[10px] font-black px-2 py-1 rounded">PRONTO</span>' : ''}
            </div>
            <h3 class="text-xl font-bold ${titleColor} mb-2">${ev.label}</h3>
            <p class="text-sm text-slate-500 italic">Preparen los materiales correspondientes para esta evaluación.</p>
          </div>
        </div>
      `;
    });
  }

  init();
</script>
</body>
</html>

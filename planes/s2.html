<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Plan de Clase - Español</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .card-shadow { box-shadow: 0 2px 4px rgba(0,0,0,0.05), 0 1px 2px rgba(0,0,0,0.1); }
  </style>
</head>

<body class="bg-slate-50 text-slate-900 min-h-screen font-sans">
  <main class="max-w-3xl mx-auto px-4 py-8 space-y-6">

    <header id="header" class="bg-[#79c9f2] rounded-xl p-6 text-white flex justify-between items-center shadow-md">
      <h1 id="dayTitle" class="text-3xl font-bold italic">Día —</h1>
      <p id="daySubtitle" class="text-lg font-medium"></p>
    </header>

    <details class="bg-white rounded-xl border border-slate-200 p-4 opacity-50 hover:opacity-100 transition-opacity">
      <summary class="text-xs font-bold text-slate-500 cursor-pointer uppercase tracking-widest">Controles del Profesor</summary>
      <div class="flex items-end gap-3 mt-4">
        <div>
          <label class="block text-xs font-bold text-slate-500 uppercase">Saltar a Día</label>
          <input id="diaInput" type="number" class="w-20 border-b-2 border-slate-200 focus:border-sky-500 outline-none py-1 text-lg" />
        </div>
        <button id="loadBtn" class="bg-sky-600 text-white px-4 py-1 rounded-lg font-bold hover:bg-sky-700">Ir</button>
      </div>
    </details>

    <section id="evalSection" class="space-y-4">
      <div class="border-l-4 border-emerald-500 pl-4">
        <h2 class="text-emerald-700 font-bold uppercase tracking-tight text-sm">Evaluación</h2>
        <div id="evalContent" class="mt-2 space-y-1"></div>
      </div>
    </section>

    <section id="calentamientoSection" class="bg-white rounded-xl border-l-4 border-red-500 p-6 card-shadow">
        <h2 class="text-red-600 font-bold text-xl mb-2">Calentamiento</h2>
        <div id="calDetail" class="text-slate-700 mb-4"></div>
        <a id="calBtn" href="#" target="_blank" class="inline-block bg-slate-100 text-sky-700 font-bold px-4 py-2 rounded-lg hover:bg-sky-50 transition-colors">
          Expandir/Reducir ↗
        </a>
    </section>

    <section id="mainContent" class="space-y-4"></section>

  </main>

  <script>
    const CONFIG = {
      COURSE: "s2",
      PLAN_URL: "https://raw.githubusercontent.com/scottscalici/imagenes/main/planes/plan_s2.json",
      EXTRAS_URL: "https://raw.githubusercontent.com/scottscalici/imagenes/main/planes/extras.json",
      EVAL_URL: "https://raw.githubusercontent.com/scottscalici/imagenes/main/planes/evaluaciones.json",
      CAL_BASE: "https://sites.google.com/view/srscalici/espa%C3%B1ol-2/planes/calentamiento"
    };

    async function fetchData() {
      const [plan, extras, evals] = await Promise.all([
        fetch(CONFIG.PLAN_URL).then(r => r.json()),
        fetch(CONFIG.EXTRAS_URL).then(r => r.json()),
        fetch(CONFIG.EVAL_URL).then(r => r.json())
      ]);
      return { plan, extras, evals };
    }

    function getActiveDia() {
      const params = new URLSearchParams(window.location.search);
      if (params.has('dia')) return parseInt(params.get('dia'));
      return parseInt(document.getElementById('diaInput').value) || 1;
    }

    async function render() {
      const { plan, extras, evals } = await fetchData();
      const DIA = getActiveDia();
      const dayData = plan.days.find(d => d.dia == DIA);

      // Header
      document.getElementById('dayTitle').textContent = `Día ${DIA}`;
      document.getElementById('daySubtitle').textContent = dayData?.fecha || "";

      // Evaluaciones (Rule of Three)
      const evalMap = new Map(evals.courses[CONFIG.COURSE].map(e => [e.dia, e.label]));
      const getEval = (d) => evalMap.get(d) || "Nada";
      
      document.getElementById('evalContent').innerHTML = `
        <p class="text-lg font-medium text-slate-800">${getEval(DIA)}</p>
        <div class="mt-4 pt-4 border-t border-slate-100">
            <p class="text-xs font-bold text-slate-400 uppercase">Próximas pruebas</p>
            <ul class="text-sm text-slate-600 mt-1 list-disc ml-4">
                <li>${getEval(DIA + 1)} - la próxima clase</li>
                <li>${getEval(DIA + 2)} - Día ${DIA + 2}</li>
            </ul>
        </div>
      `;

      // Calentamiento
      document.getElementById('calDetail').innerHTML = `
        <p class="font-medium text-slate-800">Práctica del Día ${DIA}</p>
        <p class="text-sm text-slate-500">Haz clic para abrir la actividad en una nueva pestaña.</p>
      `;
      document.getElementById('calBtn').href = `${CONFIG.CAL_BASE}/${DIA}`;

      // Main Blocks (Lecturas/Extras)
      const contentEl = document.getElementById('mainContent');
      contentEl.innerHTML = "";
      
      dayData?.blocks?.forEach(block => {
        if (block.kind === 'calentamiento') return; // Handled above
        
        const extraData = extras.items.find(i => i.id === block.ref);
        if (extraData) {
            const card = document.createElement('div');
            card.className = "bg-white rounded-xl border-l-4 border-indigo-500 p-6 card-shadow";
            card.innerHTML = `
                <h2 class="text-indigo-600 font-bold text-xl mb-2">${extraData.title}</h2>
                <div class="text-slate-700">${extraData.instructions || ""}</div>
                ${extraData.sentences ? `<ol class="list-decimal ml-5 mt-3 space-y-1">${extraData.sentences.map(s => `<li>${s}</li>`).join('')}</ol>` : ""}
            `;
            contentEl.appendChild(card);
        }
      });
    }

    document.getElementById('loadBtn').addEventListener('click', render);
    render();
  </script>
</body>
</html>

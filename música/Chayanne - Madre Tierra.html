<!DOCTYPE html>
<html>
<head>
<style>
body { font-family: sans-serif; margin: 15px; color: #2c3e50; }
.header { background: #2c3e50; color: white; padding: 15px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; margin-bottom:15px; }
.grid { display: grid; grid-template-columns: 1.2fr 0.8fr; gap: 20px; }
.timer { font-size: 3.5rem; font-weight: bold; text-align: center; margin: 10px 0; }
.notes { border: 2px solid #eee; padding: 15px; border-radius: 8px; min-height: 500px; background: #fafafa; overflow-y: auto; }
.btn { cursor: pointer; border: none; padding: 12px; border-radius: 6px; font-weight: bold; color: white; background: #3498db; width: 100%; margin-bottom: 5px; }
img { width: 100%; border-radius: 8px; background: #eee; min-height: 250px; object-fit: contain; }
.link-btn { display: inline-block; padding: 8px 12px; background: #7f8c8d; color: white; text-decoration: none; border-radius: 4px; font-size: 0.8rem; margin-bottom: 10px; margin-right: 5px; font-weight: bold; }
.q-box { background: #fff9db; padding: 12px; border-radius: 8px; margin-top: 15px; border: 2px dashed #f1c40f; }
</style>
</head>
<body>
<div class='header'><div><strong>Objetivo: <span id='goalText'>:00</span></strong> | <strong>Organizaci√≥n social</strong><br><span id='tTitle' style='font-size:1.3rem; font-weight:bold; color:#ecf0f1;'>Cargando...</span><br></div><button id='simBtn' class='btn' style='background:#9b59b6; width:auto;' onclick='forceSim()'>‚ö†Ô∏è Simulaci√≥n</button></div>
<div class='grid'><div id='left'><img id='mainImg' src=''><div id='clock' class='timer'>00:00</div><div id='success_msg' style='display:none; color:#27ae60; font-weight:bold; text-align:center; margin-top:-10px; margin-bottom:10px;'>‚ú® TIEMPO M√çNIMO ALCANZADO ‚ú®</div><button id='mainBtn' class='btn' onclick='startPrep()'>Empezar Preparaci√≥n</button></div><div id='right'><div class='notes' id='notesArea'>Sincronizando...</div></div></div>
<div id='qZone' style='display:none; text-align:center; padding-top:20px; border-top:1px solid #eee;'><div id='qDisplay' style='font-weight:bold; font-size:1.4rem; margin-bottom:15px;'></div><button class='btn' style='background:#27ae60; width:auto; margin:5px;' onclick='ask(1)'>Nivel 1</button><button class='btn' style='background:orange; width:auto; margin:5px;' onclick='ask(2)'>Nivel 2</button><button class='btn' style='background:red; width:auto; margin:5px;' onclick='ask(3)'>Nivel 3</button></div>
<script>
var seconds=0; var loop; var customQ=null; var isSim = false; var hasQ=false; var isSpeaking = false;
var config = { prep: 480, goal: 0, type: 'script', bullets: 0 };
fetch('https://raw.githubusercontent.com/scottscalici/imagenes/main/planes/conversaciones.json?v=' + Date.now()).then(function(r){return r.json()}).then(function(d){
  var l = d.items['conv-s2-madretierra'];
  if(l){ 
    document.getElementById('mainImg').src = l.imagen; 
    customQ = l.preguntas;
    document.getElementById('tTitle').innerText = l.titulo; 
    document.getElementById('notesArea').innerText = 'Listo: ' + l.titulo; 
  }
});
function updateC(){ 
  var el=document.getElementById('clock'); 
  var msg=document.getElementById('success_msg'); 
  var a=Math.abs(seconds); 
  el.innerText=(seconds<0?'-':'')+Math.floor(a/60)+':'+(a%60<10?'0':'')+a%60; 
  if(isSpeaking && config.goal === 240 && seconds <= 60 && seconds >= 0) { 
     el.style.color='#27ae60'; if(msg) msg.style.display='block'; 
  } else if(seconds<0) { 
     el.style.color='red'; if(msg) msg.style.display='none'; 
  } else { 
     el.style.color='black'; if(msg) msg.style.display='none'; 
  }
}
function forceSim(){ isSim = true; config.prep = 900; config.goal = 240; config.bullets = 10; config.type = 'bullets';
document.getElementById('goalText').innerText = '4:00';
document.getElementById('simBtn').innerText = 'MODO SIMULACI√ìN ACTIVADO';
document.getElementById('simBtn').style.opacity = '0.5';
seconds = 0; isSpeaking = false; updateC(); }
function buildNotes(){
  var area = document.getElementById('notesArea'); area.innerHTML = '';
  if(!isSim){
    area.innerHTML += '<a href="https://sites.google.com/view/srscalici/vocabulario/modismos" target="_blank" class="link-btn">üó£Ô∏è Modismos</a>';
    area.innerHTML += '<a href="https://sites.google.com/view/srscalici/ib-espa%C3%B1ol-ii/ib/conexiones-culturales" target="_blank" class="link-btn">üåé Cultura</a><hr>';
  }
  if(config.type==='script') area.innerHTML += '<strong>Guion:</strong><textarea style="width:95%; height:320px;"></textarea>';
  else if(config.type==='hybrid') { area.innerHTML += '<strong>Frase:</strong><br><input type="text" style="width:90%;"><br><strong>Notas:</strong><br>'; for(var i=1; i<=config.bullets; i++) area.innerHTML += i + '. <input type="text" style="width:80%;"><br>'; }
  else { area.innerHTML += '<strong>Notas:</strong><br>'; for(var i=1; i<=config.bullets; i++) area.innerHTML += i + '. <input type="text" style="width:80%;"><br>'; }
  if(hasQ && !isSim) { area.innerHTML += '<div class="q-box"><strong>Pregunta:</strong><br><input type="text" style="width:90%;"></div>'; }
}
function startPrep(){ clearInterval(loop); isSpeaking = false; seconds=config.prep; buildNotes(); loop=setInterval(function(){seconds--; updateC(); if(seconds<=0) waitToSpeak();},1000); document.getElementById('mainBtn').innerText='TERMINAR PREPARACI√ìN'; document.getElementById('mainBtn').onclick=waitToSpeak; }
function waitToSpeak(){ clearInterval(loop); document.getElementById('clock').style.color='#3498db'; document.getElementById('mainBtn').innerText='LISTO PARA HABLAR'; document.getElementById('mainBtn').style.background='#f39c12'; document.getElementById('mainBtn').onclick=startSpeak; }
function startSpeak(){ clearInterval(loop); isSpeaking = true; seconds=config.goal; document.getElementById('mainBtn').style.background='#e74c3c'; loop=setInterval(function(){seconds--; updateC();},1000); document.getElementById('mainBtn').innerText='Finalizar'; document.getElementById('mainBtn').onclick=end; }
function end(){ clearInterval(loop); isSpeaking = false; document.getElementById('qZone').style.display='block'; }
function ask(l){ if(customQ && customQ[l]) document.getElementById('qDisplay').innerText = customQ[l][Math.floor(Math.random()*customQ[l].length)]; }
</script></body></html>

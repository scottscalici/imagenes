<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calentamiento Diario</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; }
    @keyframes popIn { 0% { transform: scale(0); opacity: 0; } 80% { transform: scale(1.1); } 100% { transform: scale(1); opacity: 1; } }
    .animate-pop { animation: popIn 0.4s ease-out forwards; }
  </style>
</head>
<body class="bg-slate-50 min-h-screen pb-20">

  <header class="sticky top-0 z-50 bg-white border-b border-slate-200 shadow-sm">
    <div class="max-w-5xl mx-auto px-4 py-3">
      <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
        
        <div class="flex-grow">
          <div class="flex items-center gap-2 mb-1">
            <h1 class="text-xl font-black text-slate-800 tracking-tight">CALENTAMIENTO</h1>
            <span id="activity-date" class="px-2 py-0.5 rounded text-xs font-bold bg-indigo-100 text-indigo-700 uppercase tracking-wide">HOY</span>
          </div>
          
          <select id="time-machine" class="w-full md:w-96 text-sm border-slate-300 rounded-lg shadow-sm focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 bg-slate-50 text-slate-600 font-medium p-2">
            <option>Cargando calendario...</option>
          </select>
        </div>

        <div class="w-full md:w-48">
          <div class="flex justify-between text-[10px] uppercase font-bold text-slate-400 mb-1">
            <span>Progreso</span>
            <span id="progress-text">0%</span>
          </div>
          <div class="h-2 bg-slate-100 rounded-full overflow-hidden">
            <div id="progress-bar" class="h-full bg-emerald-500 w-0 transition-all duration-500"></div>
          </div>
        </div>
      </div>
    </div>
  </header>

  <main class="max-w-4xl mx-auto px-4 py-8">
    
    <div id="status-msg" class="hidden mb-6 p-4 rounded-xl border text-sm"></div>

    <div class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden min-h-[500px]">
      
      <div class="md:grid md:grid-cols-[200px,1fr] h-full">
        
        <aside class="bg-slate-50 border-b md:border-b-0 md:border-r border-slate-200 p-2 md:p-4 flex md:flex-col gap-2 overflow-x-auto">
          <nav id="nav-tabs" class="flex md:flex-col gap-2 min-w-max"></nav>
        </aside>

        <section class="p-6 md:p-8">
          <div id="module-container">
            <div class="flex flex-col items-center justify-center h-64 text-slate-400">
              <svg class="animate-spin h-8 w-8 text-indigo-500 mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
              <p>Cargando ejercicio...</p>
            </div>
          </div>
        </section>

      </div>
    </div>
  </main>

  <script>
    /*******************************************************
     * 1. THE SCHEDULE (EL CEREBRO)
     * This is the ONLY part you edit to add new days.
     *******************************************************/
    const SCHEDULE = {
      "2026-02-14": {
         title: "D√≠a 46: Presente de Subjuntivo",
         verbs: "https://raw.githubusercontent.com/scottscalici/imagenes/main/verbos/dailyJSON/presente-de-subjuntivo9.json",
         vocab: "https://raw.githubusercontent.com/scottscalici/imagenes/main/vocabulario/rdv/D2-3-7.json",
         // image: "https://.../fun_fact.jpg"
      },
      "2026-02-13": {
         title: "D√≠a 45: Pret√©rito Perfecto",
         verbs: "https://raw.githubusercontent.com/scottscalici/imagenes/main/verbos/dailyJSON/presente-de-subjuntivo8.json", // Update this URL
         vocab: "https://raw.githubusercontent.com/scottscalici/imagenes/main/vocabulario/rdv/D2-3-7.json"
      },
      "2026-02-12": {
         title: "D√≠a 44: Futuro Simple",
         verbs: "https://raw.githubusercontent.com/scottscalici/imagenes/main/verbos/dailyJSON/presente-de-subjuntivo7.json", // Update this URL
         vocab: "https://raw.githubusercontent.com/scottscalici/imagenes/main/vocabulario/rdv/D2-3-7.json"
      }
    };
    
    const VIP_VERBS = ["ser", "estar", "ir", "haber", "tener", "hacer", "poder", "decir", "ver", "dar", "saber", "querer", "llegar", "pasar", "deber", "poner", "quedar", "creer", "hablar", "llevar", "dejar", "seguir", "encontrar", "llamar", "venir"];

    /*******************************************************
     * 2. CORE LOGIC (SEEDED RANDOM & STATE)
     *******************************************************/
    let currentSeed = 1;
    function setupSeed(str) {
        let h = 2166136261 >>> 0;
        for (let i = 0; i < str.length; i++) h = Math.imul(h ^ str.charCodeAt(i), 16777619);
        currentSeed = h;
    }
    function seededRandom() {
        let t = currentSeed += 0x6D2B79F5;
        t = Math.imul(t ^ t >>> 15, t | 1);
        t ^= t + Math.imul(t ^ t >>> 7, t | 61);
        return ((t ^ t >>> 14) >>> 0) / 4294967296;
    }
    function shuffle(arr) {
        for (let i = arr.length - 1; i > 0; i--) {
            const j = Math.floor(seededRandom() * (i + 1));
            [arr[i], arr[j]] = [arr[j], arr[i]];
        }
    }

    // App State
    let state = {
        date: null,
        modules: [], // { type: 'verb', data: [...] }
        currentModule: 0,
        completed: {}
    };

    /*******************************************************
     * 3. DATA FETCHING & MIXING
     *******************************************************/
    async function fetchDay(dateStr) {
        setupSeed(dateStr); // Lock randomness to this date
        
        const plan = SCHEDULE[dateStr];
        if (!plan) return null;

        let modules = [];
        
        // A. Fetch Verbs
        try {
            const res = await fetch(plan.verbs);
            const data = await res.json();
            let allItems = Array.isArray(data) ? data : (data.items || []);
            
            // Smart Mix (VIPs + Randoms) if large file
            if (allItems.length > 20) {
                const vips = [], others = [];
                allItems.forEach(i => VIP_VERBS.includes(i.infinitivo) ? vips.push(i) : others.push(i));
                shuffle(vips); shuffle(others);
                
                let selection = [];
                // Try for 12 VIPs, 8 Others
                for(let i=0; i<12; i++) if(vips.length) selection.push(vips.pop()); else if(others.length) selection.push(others.pop());
                for(let i=0; i<8; i++) if(others.length) selection.push(others.pop()); else if(vips.length) selection.push(vips.pop());
                
                shuffle(selection);
                allItems = selection;
            }

            // Split into 4 chunks of 5
            for(let i=0; i<4; i++) {
                const chunk = allItems.slice(i*5, (i+1)*5);
                if(chunk.length) modules.push({ type: 'verb', id: i+1, items: chunk, label: `Verbos ${i+1}` });
            }
        } catch(e) { console.error("Verb Error", e); }

        // B. Fetch Vocab
        try {
            const res = await fetch(plan.vocab);
            const data = await res.json();
            let raw = Array.isArray(data) ? data : (data.items || data.vocabulario || []);
            // Clean vocab list
            let clean = raw.map(e => ({ sp: e.spanish||e.es||e.palabra, en: e.english||e.en||e.traducci√≥n })).filter(x=>x.sp&&x.en).slice(0,30);
            
            // Split into 3 chunks of 10
            for(let i=0; i<3; i++) {
                const chunk = clean.slice(i*10, (i+1)*10);
                if(chunk.length) modules.push({ type: 'vocab', id: 5+i, items: chunk, label: `Vocab ${i+1}` });
            }
        } catch(e) { console.error("Vocab Error", e); }

        // C. Final Screen
        modules.push({ type: 'final', id: 99, label: 'Fin', img: plan.image });

        return modules;
    }

    /*******************************************************
     * 4. UI BUILDERS
     *******************************************************/
    const container = document.getElementById('module-container');
    const navTabs = document.getElementById('nav-tabs');

    function renderTabs() {
        navTabs.innerHTML = "";
        state.modules.forEach((mod, idx) => {
            const btn = document.createElement("button");
            // Styling logic
            const isActive = idx === state.currentModule;
            const isLocked = idx > 0 && !state.completed[idx-1];
            const isDone = state.completed[idx];

            let classes = "w-full text-left px-4 py-3 rounded-lg text-sm font-bold transition-all flex items-center justify-between ";
            if (isActive) classes += "bg-indigo-600 text-white shadow-md ring-2 ring-indigo-200 ring-offset-1";
            else if (isLocked) classes += "bg-transparent text-slate-400 cursor-not-allowed";
            else classes += "bg-white text-slate-600 hover:bg-slate-100 border border-slate-200";

            btn.className = classes;
            btn.disabled = isLocked;
            btn.innerHTML = `<span>${mod.label}</span>`;
            
            if (isDone) btn.innerHTML += ` <span class="text-xs">‚úî</span>`;
            else if (isLocked) btn.innerHTML += ` <span class="text-xs">üîí</span>`;
            else if (isActive) btn.innerHTML += ` <span class="text-xs">‚óè</span>`;

            btn.onclick = () => {
                if(!isLocked) { state.currentModule = idx; renderModule(); renderTabs(); }
            };
            navTabs.appendChild(btn);
        });
        updateProgress();
    }

    function renderModule() {
        const mod = state.modules[state.currentModule];
        container.innerHTML = "";

        // HEADER
        const header = document.createElement("div");
        header.className = "mb-6 border-b border-slate-100 pb-4";
        header.innerHTML = `<h2 class="text-2xl font-black text-slate-800">${mod.label}</h2>`;
        
        // BODY
        const body = document.createElement("div");
        
        if (mod.type === 'verb') {
            body.className = "space-y-4";
            mod.items.forEach((item, i) => {
                const ans = Array.isArray(item.forma) ? item.forma.join("|") : item.forma;
                const trad = item.traducci√≥n || item.traduccion || item.translation || "";
                body.innerHTML += `
                <div class="verb-row py-2 border-b border-slate-50" data-answer="${ans}">
                   <div class="flex flex-wrap items-baseline gap-2 text-lg">
                      <span class="font-bold text-slate-700">${i+1}. <span class="text-xs bg-slate-100 text-slate-500 px-1 rounded uppercase">${item.tiempo||"Verbo"}</span> ${item.sujeto||""}</span>
                      <input class="border-b-2 border-slate-300 bg-slate-50 focus:bg-white focus:border-indigo-600 outline-none px-2 w-40 font-bold text-indigo-700 text-center" placeholder="?">
                      <span class="text-slate-500 text-base">(${item.infinitivo}) <i class="text-slate-400 text-sm not-italic">${trad ? '‚Äî '+trad : ''}</i></span>
                   </div>
                   <div class="feedback text-xs font-bold mt-1 ml-1 h-4"></div>
                </div>`;
            });
            // Footer
            const footer = document.createElement("div");
            footer.className = "mt-8 flex gap-4";
            footer.innerHTML = `<button class="btn-check px-6 py-2 bg-indigo-600 text-white rounded-lg font-bold shadow hover:bg-indigo-700 transition">Corregir</button><span class="result text-sm font-bold flex items-center text-slate-600"></span>`;
            footer.querySelector(".btn-check").onclick = () => checkVerbs(body, footer);
            body.appendChild(footer);
        } 
        
        else if (mod.type === 'vocab') {
             body.className = "space-y-3";
             mod.items.forEach((item, i) => {
                 body.innerHTML += `
                 <div class="vocab-row grid grid-cols-[1fr,1.5fr] gap-4 items-center" data-answer="${item.en}">
                    <div class="text-right text-sm font-semibold text-slate-600">${item.sp}</div>
                    <div class="flex flex-col"><input class="border rounded px-3 py-1.5 text-sm focus:ring-2 focus:ring-indigo-200 outline-none"><div class="feedback text-xs h-4"></div></div>
                 </div>`;
             });
             const footer = document.createElement("div");
             footer.className = "mt-8 flex gap-4";
             footer.innerHTML = `<button class="btn-check px-6 py-2 bg-indigo-600 text-white rounded-lg font-bold shadow hover:bg-indigo-700 transition">Corregir Vocab</button><span class="result text-sm font-bold flex items-center text-slate-600"></span>`;
             footer.querySelector(".btn-check").onclick = () => checkVocab(body, footer);
             body.appendChild(footer);
        }

        else if (mod.type === 'final') {
             body.className = "text-center py-10";
             body.innerHTML = `
               ${mod.img ? `<img src="${mod.img}" class="mx-auto rounded-xl shadow-lg max-h-64 mb-6 border-4 border-white">` : ''}
               <div class="inline-flex items-center justify-center w-20 h-20 bg-emerald-100 text-emerald-600 rounded-full mb-4 animate-pop">
                  <svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="4" d="M5 13l4 4L19 7"></path></svg>
               </div>
               <h2 class="text-3xl font-black text-slate-800">¬°Completado!</h2>
               <p class="text-slate-500 mt-2">Excelente trabajo hoy.</p>
               <div class="mt-8 bg-indigo-50 p-4 rounded-lg inline-block text-indigo-800 font-bold">
                  Siguiente paso: Schoology
               </div>
             `;
        }

        container.appendChild(header);
        container.appendChild(body);
    }

    /*******************************************************
     * 5. CHECKING LOGIC
     *******************************************************/
    function checkVerbs(container, footer) {
        let correct = 0, total = 0;
        const rows = container.querySelectorAll(".verb-row");
        
        rows.forEach(row => {
            total++;
            const input = row.querySelector("input");
            const feedback = row.querySelector(".feedback");
            const val = input.value.trim().toLowerCase();
            const valid = row.dataset.answer.split("|").map(s=>s.trim().toLowerCase());
            
            if (valid.includes(val)) {
                correct++;
                input.className = "border-b-2 border-emerald-500 bg-emerald-50 px-2 w-40 font-bold text-emerald-700 text-center outline-none";
                feedback.textContent = "¬°Bien!"; feedback.className = "feedback text-xs font-bold mt-1 ml-1 h-4 text-emerald-600";
            } else {
                input.className = "border-b-2 border-red-400 bg-red-50 px-2 w-40 font-bold text-red-600 text-center outline-none";
                feedback.textContent = row.dataset.answer.replace(/\|/g, " o "); feedback.className = "feedback text-xs font-bold mt-1 ml-1 h-4 text-red-500";
            }
        });

        const score = correct/total;
        footer.querySelector(".result").textContent = `${correct}/${total}`;
        
        if (score >= 0.5) {
            state.completed[state.currentModule] = true;
            renderTabs();
            // Add Next Button
            if (state.currentModule < state.modules.length - 1) {
                const btn = document.createElement("button");
                btn.className = "ml-auto px-4 py-2 bg-emerald-600 text-white rounded-lg font-bold hover:bg-emerald-700 animate-pop";
                btn.textContent = "Siguiente ‚Üí";
                btn.onclick = () => { state.currentModule++; renderModule(); renderTabs(); };
                footer.appendChild(btn);
            }
        }
    }

    // (Simplified Vocab Check)
    function checkVocab(container, footer) {
        // ... similar logic, just checking input vs dataset.answer using Levenshtein if you want ...
        // For brevity in this full-file dump, doing strict check:
        let correct = 0, total = 0;
        const rows = container.querySelectorAll(".vocab-row");
        rows.forEach(row => {
            total++;
            const input = row.querySelector("input");
            const val = input.value.trim().toLowerCase();
            const ans = row.dataset.answer.toLowerCase();
            // Allow small typos logic here normally
            if (val === ans) { correct++; input.classList.add("bg-emerald-50", "border-emerald-500"); }
            else { input.classList.add("bg-red-50", "border-red-400"); }
        });
        
        if (correct/total >= 0.5) {
             state.completed[state.currentModule] = true;
             renderTabs();
             if (state.currentModule < state.modules.length - 1) {
                const btn = document.createElement("button");
                btn.className = "ml-auto px-4 py-2 bg-emerald-600 text-white rounded-lg font-bold";
                btn.textContent = "Siguiente ‚Üí";
                btn.onclick = () => { state.currentModule++; renderModule(); renderTabs(); };
                footer.appendChild(btn);
             }
        }
    }

    function updateProgress() {
        const total = state.modules.length;
        const done = Object.keys(state.completed).length;
        const pct = Math.round((done / total) * 100);
        document.getElementById("progress-bar").style.width = pct + "%";
        document.getElementById("progress-text").textContent = pct + "%";
    }

    /*******************************************************
     * 6. INIT & TIME MACHINE
     *******************************************************/
    async function loadDay(dateStr) {
        document.getElementById("module-container").innerHTML = '<div class="p-10 text-center text-slate-400">Cargando...</div>';
        
        const modules = await fetchDay(dateStr);
        
        if (!modules) {
            document.getElementById("module-container").innerHTML = '<div class="p-10 text-center text-red-400 font-bold">No hay actividad asignada para esta fecha.</div>';
            return;
        }

        // Reset State
        state = { date: dateStr, modules: modules, currentModule: 0, completed: {} };
        
        // Update Title
        const label = SCHEDULE[dateStr].title;
        document.getElementById("activity-date").textContent = dateStr;
        
        renderTabs();
        renderModule();
    }

    function init() {
        const today = new Date().toISOString().split('T')[0];
        const selector = document.getElementById("time-machine");
        selector.innerHTML = "";

        // Sort dates (newest first)
        const dates = Object.keys(SCHEDULE).sort().reverse();
        
        dates.forEach(d => {
            const opt = document.createElement("option");
            opt.value = d;
            opt.textContent = `${d} ‚Äî ${SCHEDULE[d].title}`;
            if (d === today) opt.selected = true;
            selector.appendChild(opt);
        });

        selector.addEventListener("change", (e) => loadDay(e.target.value));

        // Load initial
        loadDay(selector.value);
    }

    init();

  </script>
</body>
</html>
